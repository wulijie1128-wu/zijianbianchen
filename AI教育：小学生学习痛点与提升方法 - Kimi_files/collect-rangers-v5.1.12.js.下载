!function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function t(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return a}function i(e,t){for(var i=0,n=t.length,o=e.length;i<n;i++,o++)e[o]=t[i];return e}var n,o=function(){function e(e){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var i=this;if(e&&t&&"function"==typeof t){this.on(e,function n(o){t(o),i.off(e,n)})}},e.prototype.off=function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var i=this._hooks[e].indexOf(t);-1!==i&&this._hooks[e].splice(i,1)}else this._hooks[e]=[]},e.prototype.emit=function(e,t,i){if(i){if(!e)return;-1!==this._cache.indexOf(i)?this._emit(e,t):(this._hooksCache.hasOwnProperty(i)||(this._hooksCache[i]={}),this._hooksCache[i].hasOwnProperty(e)||(this._hooksCache[i][e]=[]),this._hooksCache[i][e].push(t))}else this._emit(e,t)},e.prototype._emit=function(e,n){e&&this._hooks[e]&&this._hooks[e].length&&i([],t(this._hooks[e])).forEach(function(e){try{e(n)}catch(e){}})},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),r=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},a=function(e){return Array.isArray(e)},s=function(e){return"boolean"==typeof e},c=function(e){return void 0===e},l=(n=+Date.now()+Number("".concat(Math.random()).slice(2,8)),function(){return n+=1}),h=function(e,t,i,n){e.addEventListener?e.addEventListener(t,i,n):e.attachEven?e.attachEven("on".concat(t),i):e["on".concat(t)]=i},u=function(e,t,i,n){e.addEventListener?e.removeEventListener(t,i,n):e.attachEven&&e.detachEven("on".concat(t),i)},p=function(e){return function(e,t,i){if("string"==typeof e&&"number"==typeof t&&"number"==typeof i){var n,o=[];i=i<=25?i:i%25;var r=String.fromCharCode(i+97);n=e.split(r);for(var a=0;a<n.length;a++){var s=parseInt(n[a],i);s=1*s^t;var c=String.fromCharCode(s);o.push(c)}return o.join("")}}(e,64,25)},f=function(e){var t=-1!==navigator.userAgent.indexOf("iPhone")||-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("Mac OS X");h(window,t?"pagehide":"beforeunload",e,!1)},d=function(e,t,i){var n=document.createElement("script");n.src=e,n.onerror=function(){i(e)},n.onload=function(){t()},document.getElementsByTagName("head")[0].appendChild(n)},g=function(){var e=0;return["hidden","msHidden","webkitHidden"].forEach(function(t){void 0!==document[t]&&(e=1)}),e},m=function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=1e3);var i,n=Date.now()+t;return i=window.setTimeout(function o(){var r=Date.now()-n;e(),n+=t,i=window.setTimeout(o,Math.max(0,t-r))},t),function(){window.clearTimeout(i)}},v=function(e){var t=document.createElement("a");return t.href=e,t},_=function(e){var t={};try{var i=v(e).search;(i=i.slice(1)).split("&").forEach(function(e){var i,n,o=e.split("=");o.length&&(i=o[0],n=o[1]);try{t[i]=decodeURIComponent(void 0===n?"":n)}catch(e){t[i]=n}})}catch(e){}return t},y=function(e){for(var t=0,i=0,n=(e+="").length,o=0;o<n;o++)((t=31*t+e.charCodeAt(i++))>0x7fffffffffff||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t},b=function(){var e=window.navigator.appName,t=window.navigator.userAgent;return-1!==e.indexOf("Microsoft Internet Explorer")&&(-1!==t.indexOf("MSIE 8.0")||-1!==t.indexOf("MSIE 7.0")||-1!==t.indexOf("MSIE 9.0"))},E=function(){var e=window.navigator.appName,t=window.navigator.userAgent;return-1!==e.indexOf("Microsoft Internet Explorer")&&(-1!==t.indexOf("MSIE 8.0")||-1!==t.indexOf("MSIE 9.0"))},w=function(){var e=window.navigator.appName,t=window.navigator.userAgent;return-1!==e.indexOf("Microsoft Internet Explorer")&&-1!==t.indexOf("MSIE 7.0")},S="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var k,T=(function(e,t){var i;i=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function i(n){function o(){}function r(t,i,r){if("undefined"!=typeof document){"number"==typeof(r=e({path:"/"},o.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var a=JSON.stringify(i);/^[\{\[]/.test(a)&&(i=a)}catch(e){}i=n.write?n.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in r)r[c]&&(s+="; "+c,!0!==r[c]&&(s+="="+r[c].split(";")[0]));return document.cookie=t+"="+i+s}}function a(e,i){if("undefined"!=typeof document){for(var o={},r=document.cookie?document.cookie.split("; "):[],a=0;a<r.length;a++){var s=r[a].split("="),c=s.slice(1).join("=");i||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(s[0]);if(c=(n.read||n)(c,l)||t(c),i)try{c=JSON.parse(c)}catch(e){}if(o[l]=c,e===l)break}catch(e){}}return e?o[e]:o}}return o.set=r,o.get=function(e){return a(e,!1)},o.getJSON=function(e){return a(e,!0)},o.remove=function(t,i){r(t,"",e(i,{expires:-1}))},o.defaults={},o.withConverter=i,o}(function(){})},e.exports=i()}(k={exports:{}},k.exports),k.exports),A=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e.prototype.getCookie=function(e){this.getItem(e)},e.prototype.setCookie=function(e,t){this.setItem(e,t)},e.prototype.removeCookie=function(e,t){this.removeItem(e)},e}();var O={getItem:function(e){try{var t=localStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){try{return T.get(e)}catch(e){return""}},setCookie:function(e,t,i,n){try{var o=n||document.domain,r=+new Date+i;T.set(e,t,{expires:new Date(r),path:"/",domain:o})}catch(e){}},removeCookie:function(e,t){try{T.remove(e,{path:"/",domain:t||""})}catch(e){}},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},D={getItem:function(e){try{var t=sessionStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e){this.getItem(e)},setCookie:function(e,t){this.setItem(e,t)},removeCookie:function(e,t){this.removeItem(e)},isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},x=function(){function e(e,t){this._storage=t&&"session"===t?D:!e&&O.isSupportLS?O:new A}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,i,n){this._storage.setCookie(e,t,i,n)},e.prototype.removeCookie=function(e,t){this._storage.removeCookie(e,t)},e}(),M=function(){function e(e,t,i){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=i}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,i=document.referrer,n=i?v(i).hostname:"",o=_(window.location.href),r="web";-1===this.appVersion.indexOf("Mobile")&&-1===this.appVersion.indexOf("Android")&&-1===this.appVersion.indexOf("iPhone")&&-1===this.appVersion.indexOf("iPad")&&-1===this.appVersion.indexOf("mini")||(r="wap"),this.utm=function(e,t,i,n){var o=new x(!1),r=new x(!1,"session"),a=e?"_tea_utm_cache_".concat(e):"_tea_utm_cache",s=e?"_$utm_from_url_".concat(e):"_$utm_from_url",c={},l=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],h={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var u=!1;for(var p in h)h[p]&&(-1!==l.indexOf(p)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[p]=h[p]):c[p]=h[p],u=!0);if(u)r.setItem(s,"1"),o.setCookie(a,JSON.stringify(c),n,i);else{var f=o.getCookie(a,i);f&&(c=JSON.parse(f))}1==r.getItem(s)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return h}return c}(this.appid,o,this.domain,this.cookie_expire);var a=this.browser(),s=this.os();return{browser:a.browser,browser_version:a.browser_version,platform:r,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:i,referrer_host:n,utm:this.utm,latest_data:this.last(i,n)}},e.prototype.last=function(e,t){var i="",n="",o="",r=location.hostname,a=!1;if(e&&t&&r!==t){i=e,n=t,a=!0;var s=_(e);s.keyword&&(o=s.keyword)}return{$latest_referrer:i,$latest_referrer_host:n,$latest_search_keyword:o,isLast:a}},e.prototype.browser=function(){var e,t,i="",n="".concat(parseFloat(this.appVersion)),o=this.userAgent;return-1!==o.indexOf("Edge")||-1!==o.indexOf("Edg")?(i="Microsoft Edge",-1!==o.indexOf("Edge")?(e=o.indexOf("Edge"),n=o.substring(e+5)):(e=o.indexOf("Edg"),n=o.substring(e+4))):-1!==o.indexOf("MSIE")||-1!==o.indexOf("Trident")?(i="Microsoft Internet Explorer",-1!==o.indexOf("MSIE")?(e=o.indexOf("MSIE"),n=o.substring(e+5,e+9)):(e=o.indexOf("rv"),n=o.substring(e+3,e+7))):-1!==(e=o.indexOf("Lark"))?(i="Lark",n=o.substring(e+5,e+11)):-1!==(e=o.indexOf("MetaSr"))?(i="sougoubrowser",n=o.substring(e+7,e+10)):-1!==o.indexOf("MQQBrowser")||-1!==o.indexOf("QQBrowser")?(i="qqbrowser",-1!==o.indexOf("MQQBrowser")?(e=o.indexOf("MQQBrowser"),n=o.substring(e+11,e+15)):-1!==o.indexOf("QQBrowser")&&(e=o.indexOf("QQBrowser"),n=o.substring(e+10,e+17))):-1!==o.indexOf("Chrome")?-1!==(e=o.indexOf("MicroMessenger"))?(i="weixin",n=o.substring(e+15,e+20)):-1!==(e=o.indexOf("360"))?(i="360browser",n=o.substring(o.indexOf("Chrome")+7)):-1!==o.indexOf("baidubrowser")||-1!==o.indexOf("BIDUBrowser")?(-1!==o.indexOf("baidubrowser")?(e=o.indexOf("baidubrowser"),n=o.substring(e+13,e+16)):-1!==o.indexOf("BIDUBrowser")&&(e=o.indexOf("BIDUBrowser"),n=o.substring(e+12,e+15)),i="baidubrowser"):-1!==(e=o.indexOf("xiaomi"))?-1!==o.indexOf("openlanguagexiaomi")?(i="openlanguage xiaomi",n=o.substring(e+7,e+13)):(i="xiaomi",n=o.substring(e-7,e-1)):-1!==(e=o.indexOf("TTWebView"))?(i="TTWebView",n=o.substring(e+10,e+23)):-1!==(e=o.indexOf("Chrome"))?(i="Chrome",n=o.substring(e+7)):-1!==(e=o.indexOf("Chrome"))&&(i="Chrome",n=o.substring(e+7)):-1!==o.indexOf("Safari")?-1!==(e=o.indexOf("QQ"))?(i="qqbrowser",n=o.substring(e+10,e+16)):-1!==(e=o.indexOf("Safari"))&&(i="Safari",n=o.substring(e+7),-1!==(e=o.indexOf("Version"))&&(n=o.substring(e+8))):-1!==(e=o.indexOf("Firefox"))?(i="Firefox",n=o.substring(e+8)):-1!==(e=o.indexOf("MicroMessenger"))?(i="weixin",n=o.substring(e+15,e+20)):-1!==(e=o.indexOf("QQ"))?(i="qqbrowser",n=o.substring(e+3,e+8)):-1!==(e=o.indexOf("Opera"))&&(i="Opera",n=o.substring(e+6),-1!==(e=o.indexOf("Version"))&&(n=o.substring(e+8))),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:i,browser_version:n}},e.prototype.os=function(){var e,t,i,n="";if(b());else{for(var o=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],r=0;r<o.length;r++){var a=o[r];if(a.r.test(this.userAgent)){"Mac OS X"===(n=a.s)&&this.isNewIpad()&&(n="iOS");break}}var s=function(e,t){var i=e.exec(t);return i&&i[1]?i[1]:""},c=function(e,t){var i=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:".concat(e,")"),"i").exec(t);return i?i.slice(1)[0]:""};/Windows/.test(n)&&(e=s(/Windows (.*)/,n),n="windows");switch(n){case"Mac OS X":e=c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),n="mac";break;case"Android":t=this.userAgent,(i=s(/Android ([\.\_\d]+)/,t))||(i=s(/Android\/([\.\_\d]+)/,t)),e=i,n="android";break;case"iOS":e=this.isNewIpad()?c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(e=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?"".concat(e[1],".").concat(e[2],".").concat(0|e[3]):"",n="ios"}}return{os_name:n,os_version:e}},e.prototype.getDeviceModel=function(e){var t="";try{if("android"===e)navigator.userAgent.split(";").forEach(function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))});else if("ios"===e||"mac"===e||"windows"===e)if(this.isNewIpad())t="iPad";else{var i=navigator.userAgent.replace("Mozilla/5.0 (",""),n=i.indexOf(";");t=i.slice(0,n)}}catch(e){return t.trim()}return t.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},e}(),C={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az24z1mz1jz1az1cz18z1nz1nz1jz1mz1ez4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},I="5.1.12_tob";var R,G,L={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},N="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-editor-rangers.js",P="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-ab-core.js",B="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/heatmap-core";!function(e){e.Init="init",e.Config="config",e.Start="start",e.ReStart="re-start-sdk",e.Stop="stop-sdk",e.Ready="ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.AnonymousId="anonymous-id",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerifyH="submit-verify-h5",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.AbTimeout="ab-timeout",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.TrackDuration="track-duration",e.TrackDurationStart="track-duration-start",e.TrackDurationEnd="track-duration-end",e.TrackDurationPause="track-duration-pause",e.TrackDurationResume="tracl-duration-resume",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.SetExposureType="set-exposure-type",e.CepReady="cep-ready",e.TracerReady="tracer-ready",e.EncryptData="encrypt-data",e.LogSettingReady="logsetting-ready",e.SetResource="set-resource"}(R||(R={})),function(e){e.DEBUGGER_MESSAGE="debugger-message",e.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",e.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",e.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",e.DEBUGGER_MESSAGE_EVENT="debugger-message-event",e.DEVTOOL_WEB_READY="devtool-web-ready"}(G||(G={}));var U=R,V=void 0,j=(new Date).getTimezoneOffset(),z=parseInt("".concat(-j/60),10),K=60*j,q=7776e6,H=function(){function t(e,t){var i=this;this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var n=new M(t.app_id,t.cookie_domain||"",t.cookie_expire||q).init(),o="__tea_cache_first_".concat(t.app_id);this.configKey="__tea_cache_config_".concat(t.app_id),this.sessionStorage=new x(!1,"session"),this.localStorage=new x(!1,"local"),t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage);var r=this.localStorage.getItem(o);r&&1==r?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(o,"1")),this.envInfo={user:{user_unique_id:V,user_type:V,user_id:V,user_is_auth:V,user_is_login:V,device_id:V,web_id:V,ip_addr_id:V,user_unique_id_type:V,anonymous_id:V},header:{app_id:V,app_name:V,app_install_id:V,install_id:V,app_package:V,app_channel:V,app_version:V,ab_version:V,os_name:n.os_name,os_version:n.os_version,device_model:n.device_model,ab_client:V,traffic_type:V,client_ip:V,device_brand:V,os_api:V,access:V,language:n.language,region:V,app_language:V,app_region:V,creative_id:n.utm.creative_id,ad_id:n.utm.ad_id,campaign_id:n.utm.campaign_id,log_type:V,rnd:V,platform:n.platform,sdk_version:I,sdk_lib:"js",province:V,city:V,timezone:z,tz_offset:K,tz_name:V,sim_region:V,carrier:V,resolution:"".concat(n.screen_width,"x").concat(n.screen_height),browser:n.browser,browser_version:n.browser_version,referrer:n.referrer,referrer_host:n.referrer_host,width:n.screen_width,height:n.screen_height,screen_width:n.screen_width,screen_height:n.screen_height,utm_term:n.utm.utm_term,utm_content:n.utm.utm_content,utm_source:n.utm.utm_source,utm_medium:n.utm.utm_medium,utm_campaign:n.utm.utm_campaign,tracer_data:JSON.stringify(n.utm.tracer_data),custom:{},wechat_unionid:V,wechat_openid:V}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(n),this.initDomain(),this.initABData(),this.collect.on("route-change",function(e){i.changeReferInfo(e.config)})}return t.prototype.initDomain=function(){var e=this.initConfig.channel_domain;if(e)this.domain=e;else{var t=this.initConfig.channel;this.domain=p(C[t])}},t.prototype.setDomain=function(e){this.domain=e},t.prototype.getDomain=function(){return this.domain},t.prototype.initABData=function(){var e="__tea_sdk_ab_version_".concat(this.initConfig.app_id),t=null;if(this.initConfig.ab_cross){var i=this.localStorage.getCookie(e,this.initConfig.ab_cookie_domain);t=i?JSON.parse(i):null}else t=this.localStorage.getItem(e);this.setAbCache(t)},t.prototype.setAbCache=function(e){this.ab_cache=e},t.prototype.getAbCache=function(){return this.ab_cache},t.prototype.clearAbCache=function(){this.ab_cache={},this.ab_version=""},t.prototype.setAbVersion=function(e){this.ab_version=e},t.prototype.getAbVersion=function(){return this.ab_version},t.prototype.getUrl=function(e){var t="";switch(e){case"event":t="/list";break;case"webid":t="/webid";break;case"tobid":t="/tobid";break;case"profile":t="/profile/list";break;case"img":t="/gif"}var i="";return this.initConfig.caller&&(i="?sdk_version=".concat(I,"&sdk_name=web&app_id=").concat(this.initConfig.app_id,"&caller=").concat(this.initConfig.caller)),this.initConfig.report_url?"".concat(this.initConfig.report_url).concat(i):"".concat(this.getDomain()).concat(t).concat(i)},t.prototype.setCustom=function(e){if(e&&e.latest_data&&e.latest_data.isLast)for(var t in delete e.latest_data.isLast,this.isLast=!0,e.latest_data)this.envInfo.header.custom[t]=e.latest_data[t]},t.prototype.changeReferInfo=function(e){var t=e;this.envInfo.header.referrer=t.referrer;var i="";try{i=new URL(t.referrer).host}catch(e){}this.envInfo.header.referrer_host=i||this.envInfo.header.referrer_host},t.prototype.set=function(t){var i=this;Object.keys(t).forEach(function(n){if(void 0!==t[n]&&null!==t[n]||i.delete(n),"traffic_type"===n&&i.isLast&&(i.envInfo.header.custom.$latest_traffic_source_type=t[n]),"evtParams"===n)i.evtParams=e(e({},i.evtParams||{}),t.evtParams||{});else if("_staging_flag"===n)i.evtParams=e(e({},i.evtParams||{}),{_staging_flag:t._staging_flag});else if("reportErrorCallback"===n&&"function"==typeof t[n])i.reportErrorCallback=t[n];else{var o="",r="";if(n.indexOf(".")>-1){var a=n.split(".");o=a[0],r=a[1]}o?"user"===o||"header"===o?i.envInfo[o][r]=t[n]:i.envInfo.header.custom[r]=t[n]:Object.hasOwnProperty.call(i.envInfo.user,n)?["user_type","ip_addr_id"].indexOf(n)>-1?i.envInfo.user[n]=t[n]?Number(t[n]):t[n]:["user_id","web_id","user_unique_id","user_unique_id_type","anonymous_id"].indexOf(n)>-1?i.envInfo.user[n]=t[n]?String(t[n]):t[n]:["user_is_auth","user_is_login"].indexOf(n)>-1?i.envInfo.user[n]=Boolean(t[n]):"device_id"===n&&(i.envInfo.user[n]=t[n]):Object.hasOwnProperty.call(i.envInfo.header,n)?i.envInfo.header[n]=t[n]:i.envInfo.header.custom[n]=t[n]}})},t.prototype.getSettingData=function(e){if(this.logSettingConfig&&!c(this.logSettingConfig[e]))return this.logSettingConfig[e]},t.prototype.setSettingData=function(e){this.logSettingConfig=e},t.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error "),this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},t.prototype.setStore=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};if(t&&Object.keys(e).length){var i=Object.assign(e,t);this.storage.setItem(this.configKey,i)}}catch(e){console.log("setStore error"),this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},t.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey)||{};return e&&Object.keys(e).length?e:null}catch(e){return this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),null}},t.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};t&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),console.log("delete error")}},t}(),J=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[instance: ".concat(this.name,"]")+" "+e)},e.prototype.warn=function(e){this.isLog&&console.warn("%c %s","color: yellow; background-color: black;","[instance: ".concat(this.name,"]")+" "+e)},e.prototype.error=function(e){this.isLog&&console.error("[instance: ".concat(this.name,"]")+" "+e)},e.prototype.throw=function(e){throw this.error(this.name),new Error(e)},e}(),W=function(){function e(e,t){this.native=e.enable_native||e["evitaN".split("").reverse().join("")],this.os=t.get("os_name")}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},t.bridgeReady=function(){var e=this;return new Promise(function(t,i){try{e.bridgeInject()?AppLogBridge.hasStarted(function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):i(!1)}):i(!1)}catch(e){console.log("AppLogBridge, error:"+JSON.stringify(e.stack)),i(!1)}})},t.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(e){console.error("setNativeAppId error")}},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach(function(i){"user_unique_id"===i?t.setUserUniqueId(e[i]):e[i]?t.addHeaderInfo(i,e[i]):t.removeHeaderInfo(i)})}catch(e){console.error("setConfig error")}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){console.error("setUserUniqueId error")}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){console.error("addHeaderInfo error")}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){console.error("setHeaderInfo error")}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){console.error("removeHeaderInfo error")}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t)}catch(e){console.error("onEventV3 error")}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){console.error("profileSet error")}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){console.error("profileSetOnce error")}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){console.error("profileIncrement error")}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){console.error("profileUnset error")}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){console.error("profileAppend error")}},t.setExternalAbVersion=function(e){try{AppLogBridge.setExternalAbVersion(e)}catch(e){console.error("setExternalAbVersion error")}},t.getVar=function(e,t,i){try{"android"===this.os?i(AppLogBridge.getABTestConfigValueForKey(e,t)):AppLogBridge.getABTestConfigValueForKey(e,t,function(e){i(e)})}catch(e){console.error("getVar error"),i(t)}},t.getAllVars=function(e){try{"android"===this.os?e(AppLogBridge.getAllAbTestConfigs()):AppLogBridge.getAllAbTestConfigs(function(t){e(t)})}catch(t){console.error("getAllVars error"),e(null)}},t.getAbSdkVersion=function(e){try{"android"===this.os?e(AppLogBridge.getAbSdkVersion()):AppLogBridge.getAbSdkVersion(function(t){e(t)})}catch(t){console.error("getAbSdkVersion error"),e("")}},e}(),F={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005};function X(e,t,i,n,o,r,a,s,c,l){try{var h;if(window.XDomainRequest&&E()){h=new XDomainRequest;var u=s||"post";h.open(u,e),i&&(h.timeout=i,h.ontimeout=function(){r&&r(t,F.TIMEOUT)}),h.onerror=function(){h.abort(),r&&r(t,F.XHR_ON)},h.onload=function(){if(o){var e=null;if(h.responseText){try{e=JSON.parse(h.responseText)}catch(t){e={}}o(e,t)}}},setTimeout(function(){h.send(JSON.stringify(t))},0)}else if(window.ActiveXObject&&w()){h=new ActiveXObject("Micrsorf.XMLHTTP");u=s||"POST";h.open(u,e),i&&(h.timeout=i,h.ontimeout=function(){r&&r(t,F.TIMEOUT)}),h.onerror=function(){h.abort(),r&&r(t,F.XHR_ON)},h.onload=function(){if(o){var e=null;if(h.responseText){try{e=JSON.parse(h.responseText)}catch(t){e={}}o(e,t)}}},setTimeout(function(){h.send(JSON.stringify(t))},0)}else if(window.XMLHttpRequest){h=new XMLHttpRequest;u=s||"POST";h.open(u,e,!0),h.setRequestHeader("Content-Type","application/json; charset=utf-8"),a&&h.setRequestHeader("X-MCS-AppKey","".concat(a)),n&&(h.withCredentials=!0),i&&(h.timeout=i,h.ontimeout=function(){r&&r(t,F.TIMEOUT)}),h.onreadystatechange=function(){if(4===h.readyState&&200===h.status&&o){var e=null;if(h.responseText){try{e=JSON.parse(h.responseText)}catch(t){e={}}o(e,t)}}},h.onerror=function(){h.abort(),r&&r(t,F.XHR_ON)},h.send(JSON.stringify(t))}}catch(e){console.log(e.message)}}var $=4e3,Q=4002,Y=4003,Z=function(e,t,i,n){try{t.forEach(function(o){var r=function(e){var t="";for(var i in e)e.hasOwnProperty(i)&&void 0!==e[i]&&(t+="&".concat(i,"=").concat(encodeURIComponent(JSON.stringify(e[i]))));return t="&"===t.slice(0,1)?t.slice(1):t}(o),a=new Image(1,1);a.onload=function(){a=null,i&&i()},a.onerror=function(){a=null,n&&n(e,t,$)},a.src="".concat(e,"?").concat(r)})}catch(i){n&&n(e,t,Q,i.message)}},ee=function(e,t,i,n,o,r,a,s,c){if(a){if(window.navigator&&window.navigator.sendBeacon)return void(window.navigator.sendBeacon(e,JSON.stringify(t))?o():r(e,t,Y));X(e,t,i,n,o,r,"","")}else X(e,t,i,n,o,r,"","")},te=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},ie=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.storage=new x(!1,"session"),this.sessionKey="__tea_session_id_".concat(t.app_id),this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(U.SessionReset,function(){i.resetSessionId()}),this.collect.on(U.SessionResetTime,function(){i.updateSessionIdTime()}))},e.prototype.updateSessionIdTime=function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:te(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:te(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime)},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},e.prototype.resetSessionId=function(){var e={sessionId:te(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&(Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:te(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e)))},e}(),ne=function(){function n(e,t){var i=this;this.MAX_LEVEL=3,this.metaResource={},this.eventCache=[],t.enable_track_id&&(this.MAX_LEVEL=t.track_level||3,e.on(U.SetResource,function(e){i.metaResource=e}))}return n.prototype.handleMetaResource=function(n){var o=this;return Object.keys(this.metaResource).length?(n.forEach(function(n){var r=n.event,a=n.local_time_ms,s=n.params,c=e({},JSON.parse(s));try{for(var l in c)if(o.metaResource.hasOwnProperty(l)){var h=c[l],u=o.metaResource[l];if(u.length&&u.includes(h)){var p=te();c.ubt_source_id=p,o.eventCache.length&&(c.ubt_source=i([],t(o.eventCache)).reverse()),o.eventCache.length>=o.MAX_LEVEL&&o.eventCache.shift(),o.eventCache.push({event:r,params:e(e({},JSON.parse(s)),{ubt_source_id:p}),local_time_ms:a})}break}}finally{n.params=JSON.stringify(c)}}),n):n},n}(),oe=function(){function n(){this.eventLimit=50,this.eventCache=[],this.beconEventCache=[]}return n.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.cacheStorgae=new x(!0),this.localStorage=new x(!1),this.trackId=new ne(e,t),this.maxReport=t.max_report||20,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_".concat(this.configManager.get("app_id")),this.beconKey="__tea_cache_events_becon_".concat(this.configManager.get("app_id")),this.abKey="__tea_sdk_ab_version_".concat(this.configManager.get("app_id")),this.refer_key="__tea_cache_refer_".concat(this.configManager.get("app_id")),this.collect.on(U.Ready,function(){i.reportAll(!1)}),this.collect.on(U.ConfigDomain,function(){i.reportUrl=i.configManager.getUrl("event")}),this.collect.on(U.Event,function(e){i.event(e)}),this.collect.on(U.BeconEvent,function(e){i.beconEvent(e)}),this.collect.on(U.CleanEvents,function(){i.reportAll(!1)}),this.linster()},n.prototype.linster=function(){var e=this;h(window,"unload",function(){e.reportAll(!0)},!1),f(function(){e.reportAll(!0)}),h(document,"visibilitychange",function(){"hidden"===document.visibilityState&&e.reportAll(!0)},!1)},n.prototype.reportAll=function(e){this.report(e),this.reportBecon()},n.prototype.event=function(e){var n=this;try{if(this.collect.sdkStop)return;if(this.collect.destroyInstance)return;var o=this.cacheStorgae.getItem(this.eventKey)||[],r=i(i([],t(e)),t(o));if(this.cacheStorgae.setItem(this.eventKey,r),this.reportTimeout&&clearTimeout(this.reportTimeout),r.length>=this.maxReport)this.report(!1);else{var a=this.reportTime;this.reportTimeout=setTimeout(function(){n.report(!1),n.reportTimeout=null},a)}}catch(e){this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},n.prototype.beconEvent=function(e){if(!this.collect.destroyInstance&&!this.collect.sdkStop){var n=this.cacheStorgae.getItem(this.beconKey)||[],o=i(i([],t(e)),t(n));this.cacheStorgae.setItem(this.beconKey,o),this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(o)),!0))}},n.prototype.reportBecon=function(){if(!this.collect.destroyInstance&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))}},n.prototype.report=function(e){if(!this.collect.destroyInstance&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];t.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))}},n.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var i=0;i<e.length;i+=this.eventLimit){var n;n=e.slice(i,i+this.eventLimit);var o=this.split(this.merge(n));this.send(o,t)}else{o=this.split(this.merge(e));this.send(o,t)}},n.prototype.merge=function(t,i){var n=this,o=this.configManager.get(),r=o.header,a=o.user;r.custom=JSON.stringify(r.custom);var s=this.configManager.get("evtParams"),c=this.configManager.get("user_unique_id_type"),l=t.filter(function(t){try{if(Object.keys(s).length&&!i&&(t.params=e(e({},t.params),s)),n.collect.dynamicParamsFilter&&!i){var o=n.collect.dynamicParamsFilter();Object.keys(o).length&&(t.params=e(e({},t.params),o))}c&&!i&&(t.params.$user_unique_id_type=c);var r=n.configManager.getAbCache(),l=n.configManager.getAbVersion();return l&&r&&(n.config.disable_ab_reset?t.ab_sdk_version=l:r.uuid===a.user_unique_id&&(t.ab_sdk_version=l)),t.session_id=n.collect.sessionManager.getSessionId(),t.params=JSON.stringify(t.params),n.blockEvent(t.event)}catch(e){return n.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),t}});this.config.enable_track_id&&(l=this.trackId.handleMetaResource(l));var h=[];if(!Object.keys(a).length)return console.warn("user info error，cant report"),h;this.config.enable_anonymousid&&delete a.web_id;var u=JSON.parse(JSON.stringify({events:l,user:a,header:r}));return u.local_time=Math.floor(Date.now()/1e3),u.verbose=1,u.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,h.push(u),h},n.prototype.split=function(e){return e=e.map(function(e){var t=[];return t.push(e),t})},n.prototype.blockEvent=function(e){try{var t=this.collect.configManager.getSettingData("blocklist_events");return!(t&&t.length&&t.includes(e))}catch(e){return!0}},n.prototype.send=function(e,t){var i=this;e.length&&e.forEach(function(e){try{var n=JSON.parse(JSON.stringify(e));i.config.filter&&((n=i.config.filter(n))||console.warn("filter must return data !!")),i.collect.eventFilter&&n&&((n=i.collect.eventFilter(n))||console.warn("filterEvent api must return data !!"));var o=n||e,r=JSON.parse(JSON.stringify(o));if(!o.length)return;var a=!0;if(o.forEach(function(e){e.events.length||(a=!1)}),!a)return;i.collect.emit(U.SubmitBefore,o);var s=i.collect.cryptoData(o);if(b())return void Z(i.configManager.getUrl("img"),s);var l=c(i.collect.configManager.getSettingData("request_timeout"))?i.timeout:i.collect.configManager.getSettingData("request_timeout");ee(i.reportUrl,s,l,!1,function(e,t){e&&0!==e.e?(i.collect.emit(U.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),i.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_EVENT,info:"埋点上报失败",time:Date.now(),data:r,code:e.e,failType:"数据异常",status:"fail"})):(i.collect.emit(U.SubmitScuess,{eventData:t,res:e}),i.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:r,code:200,status:"success"}))},function(e,t){i.configManager.get("reportErrorCallback")(e,t),i.collect.emit(U.SubmitError,{type:"f_net",eventData:e,errorCode:t}),i.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_EVENT,info:"埋点上报网络异常",time:Date.now(),data:r,code:t,failType:"网络异常",status:"fail"})},t,i.config.enable_encryption,i.config.encryption_header),i.collect.emit(U.SubmitVerifyH,o),i.collect.emit(U.SubmitAfter,o)}catch(e){console.warn("something error, ".concat(JSON.stringify(e.stack))),i.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}})},n}(),re=function(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}().replace(/-/g,"").slice(0,19)},ae=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enableTTwebid=!1,this.enableCustomWebid=!1,this.enableAnonymousid=!1}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new x(!1),this.tokenKey="__tea_cache_tokens_".concat(t.app_id),this.enableAnonymousid=t.enable_anonymousid,this.enableTTwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.timeout=t.timeout||3e5,this.collect.on(U.AnonymousId,function(e){i.setAnonymousId(e)}),this.collect.on(U.ConfigUuid,function(e){i.setUuid(e)}),this.collect.on(U.ConfigWebId,function(e){i.setWebId(e)}),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e=this;if(this.enableCookie){var t=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=t&&"string"==typeof t?JSON.parse(t):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid||this.enableAnonymousid?this.enableAnonymousid?this.completeAnonymous(this.cacheToken):this.enableCustomWebid?this.collect.on(U.CustomWebId,function(){e.tokenReady=!0,e.collect.emit(U.TokenComplete)}):this.checkEnv()||(this.enableTTwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){if(this.cacheToken&&this.cacheToken.web_id)this.complete(this.cacheToken);else if(this.config.disable_webid){var e=this.getLocalId();this.complete({web_id:e,user_unique_id:this.configManager.get("user_unique_id")||e})}else this.remoteWebid()},e.prototype.checkEnv=function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram")){var t=_(window.location.href);return!(!t||!t.Web_ID)&&(this.complete({web_id:"".concat(t.Web_ID),user_unique_id:this.configManager.get("user_unique_id")||"".concat(t.Web_ID)}),!0)}return!1},e.prototype.remoteWebid=function(){var e=this,t=this.configManager.getUrl("webid"),i={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 发起WEBID请求",logType:"fetch",level:"info",time:Date.now(),data:i}),X(t,this.collect.cryptoData(i),this.timeout,!1,function(t){var i;if(t&&0===t.e)i=t.web_id,e.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"WEBID请求成功",logType:"fetch",level:"info",time:Date.now(),data:t});else{var n=e.getLocalId();i=n,e.collect.configManager.set({localWebId:n}),e.collect.emit(U.TokenError),e.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"WEBID请求返回值异常",logType:"fetch",level:"warn",time:Date.now(),data:t}),e.collect.logger.warn("appid: ".concat(e.config.app_id," get webid error, use local webid~"))}e.complete({web_id:e.configManager.get("web_id")||i,user_unique_id:e.configManager.get("user_unique_id")||i})},function(){var t=e.getLocalId();e.complete({web_id:e.configManager.get("web_id")||t,user_unique_id:e.configManager.get("user_unique_id")||t}),e.collect.configManager.set({localWebId:t}),e.collect.emit(U.TokenError),e.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"WEBID请求网络异常",logType:"fetch",level:"error",time:Date.now(),data:null}),e.collect.logger.warn("appid: ".concat(e.config.app_id,", get webid error, use local webid~"))},"","",this.config.enable_encryption,this.config.encryption_header)},e.prototype.getLocalId=function(){for(var e=re(),t=0;0===e.indexOf("0")||0===e.indexOf("9");){if(t>=10){e=e.replace(/^(0|9)/,"");break}e=re(),t++}return e},e.prototype.complete=function(e){var t=e.web_id,i=e.user_unique_id;if(!t&&!i)return this.collect.emit(U.TokenError),void console.warn("token error");e.timestamp=Date.now(),0===t.indexOf("9")&&t.length>18?this.remoteWebid():(this.collect.configManager.set({web_id:t,user_unique_id:i}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(U.TokenComplete))},e.prototype.completeAnonymous=function(e){var t=e.anonymous_id||te(),i=e.user_unique_id||this.configManager.get("user_unique_id");this.collect.configManager.set({anonymous_id:t,user_unique_id:i||t}),e.anonymous_id=t,e.user_unique_id=i||t,this.setStorage(e),this.tokenReady=!0,this.collect.emit(U.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",i=this.configManager.get("user_unique_id");this.configManager.set({user_unique_id:i||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(U.TokenComplete)},e.prototype.setUuid=function(e){if(e&&-1===["null","undefined","Null","None"].indexOf(e)){var t=String(e),i=this.configManager.get("user_unique_id"),n=this.cacheToken&&this.cacheToken.user_unique_id;if(t===i&&t===n)return;this.configManager.set({user_unique_id:t}),this.cacheToken?this.cacheToken.user_unique_id=t:(this.cacheToken={},this.cacheToken.user_unique_id=t),this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(U.TokenChange,{type:"uuid",id:e}),this.collect.emit(U.ProfileClear),this.collect.emit(U.SessionReset)}else this.clearUuid()},e.prototype.clearUuid=function(){if(!this.config.enable_ttwebid){var e=this.enableAnonymousid?this.configManager.get("anonymous_id"):this.configManager.get("web_id");this.configManager.get("user_unique_id")!==e&&(this.configManager.set({user_unique_id:e}),this.cacheToken.user_unique_id=e,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(U.ProfileClear),this.collect.emit(U.TokenReset))}},e.prototype.setAnonymousId=function(e){if(e&&this.enableAnonymousid){var t=this.configManager.get("anonymous_id"),i=this.configManager.get("user_unique_id");t!==e&&(t!==i&&i||(this.configManager.set({user_unique_id:e}),this.cacheToken.user_unique_id=e,this.collect.emit(U.TokenChange,{type:"uuid",id:e})),this.configManager.set({anonymous_id:e}),this.cacheToken.anonymous_id=e,this.collect.emit(U.TokenChange,{type:"anonymous_id",id:e}),this.setStorage(this.cacheToken))}},e.prototype.setWebId=function(e){if(e&&!this.config.enable_ttwebid&&!this.enableAnonymousid){var t=this.configManager.get("web_id"),i=this.configManager.get("user_unique_id");i&&i!==t||(this.configManager.set({user_unique_id:e}),this.cacheToken.user_unique_id=e,this.collect.emit(U.TokenChange,{type:"uuid",id:e})),t!==e&&(this.configManager.set({web_id:e}),this.cacheToken.web_id=e,this.collect.emit(U.ProfileClear),this.collect.emit(U.TokenChange,{type:"webid",id:e})),this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)}},e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enableTTwebid?this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(e){var t=this.configManager.getUrl("tobid"),i={app_id:this.config.app_id,user_unique_id:this.configManager.get("user_unique_id"),user_unique_id_type:this.configManager.get("user_unique_id_type")};this.enableAnonymousid?i.anonymous_id=this.configManager.get("anonymous_id"):i.web_id=this.configManager.get("web_id"),X(t,this.collect.cryptoData(i),3e4,this.enableTTwebid,function(t){t&&0===t.e?e(t.tobid):e("")},function(){e("")},"","",this.config.enable_encryption,this.config.encryption_header)},e}(),se={autotrack:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/route.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},tracer:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"}},ce=function(){return"undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null},le=ce(),he=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach(function(t,i){if("sdk"===t)if(se.hasOwnProperty(i)){var n=se[i].object,o="".concat(se[i].src[e.channel],"?query=").concat(Date.now());e.exist(i,n,o)}else console.warn("your ".concat(i," is not exist，please check plugin name"));else"object"==typeof t&&(t.src?e.exist(i,t.call,t.src):e.process(i,t.instance,"INSTANCE"))})}catch(e){this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),console.log("load extend error")}},e.prototype.exist=function(e,t,i){var n=this;le[t]?this.process(e,le[t]):this.loadPlugin(e,i,function(){n.process(e,le[t]),console.log(" %c %s %s %s","color: yellow; background-color: black;","–","load plugin:".concat(e," success"),"-")},function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","–","load plugin:".concat(e," error"),"-")})},e.prototype.process=function(e,t,i){try{if(i){var n=new t;n.apply&&n.apply(this.collect,this.config),console.log("excude ".concat(e," success"))}else t&&t(this.collect,this.config)}catch(t){this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),console.log("excude ".concat(e," error, message:").concat(t.message))}},e.prototype.loadPlugin=function(e,t,i,n){var o=this;try{var r=document.createElement("script");r.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(i),r.onerror=function(){n(t)},r.onload=function(){o._plugin[e].forEach(function(e){e()})},document.getElementsByTagName("head")[0].appendChild(r)}catch(e){this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},e}(),ue=function(){function t(){}return t.prototype.apply=function(e,t){var i=this;if(!b()){this.collect=e,this.config=t,this.duration=6e4,this.reportUrl="".concat(e.configManager.getDomain(),"/profile/list");var n=e.Types,o=e.adapters.fetch;this.fetch=o,this.cache={},this.collect.on(n.ProfileSet,function(e){i.setProfile(e)}),this.collect.on(n.ProfileSetOnce,function(e){i.setOnceProfile(e)}),this.collect.on(n.ProfileUnset,function(e){i.unsetProfile(e)}),this.collect.on(n.ProfileIncrement,function(e){i.incrementProfile(e)}),this.collect.on(n.ProfileAppend,function(e){i.appendProfile(e)}),this.collect.on(n.ProfileClear,function(){i.cache={}}),this.ready(n.Profile)}},t.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach(function(i){t.collect.hook.emit(e,i)})};for(var o in i)n(o)}},t.prototype.report=function(e,t){void 0===t&&(t={});try{if(this.config.disable_track_event)return;if(this.collect.sdkStop)return;var i=[];i.push(this.collect.processEvent(e,t));var n=this.collect.eventManager.merge(i,!0),o=this.collect.cryptoData(n),r=this.collect.configManager.getUrl("profile");this.fetch(r,o,1e5,!1,function(){},function(){},"","POST",this.config.enable_encryption,this.config.encryption_header),this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:n,code:200,status:"success"})}catch(e){this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},t.prototype.setProfile=function(t){var i=this.formatParams(t);i&&Object.keys(i).length&&(this.pushCache(i),this.report("__profile_set",e(e({},i),{profile:!0})))},t.prototype.setOnceProfile=function(t){var i=this.formatParams(t,!0);i&&Object.keys(i).length&&(this.pushCache(i),this.report("__profile_set_once",e(e({},i),{profile:!0})))},t.prototype.incrementProfile=function(t){t?this.report("__profile_increment",e(e({},t),{profile:!0})):console.warn("please check the params, must be object!!!")},t.prototype.unsetProfile=function(t){if(t){var i={};i[t]="1",this.report("__profile_unset",e(e({},i),{profile:!0}))}else console.warn("please check the key, must be string!!!")},t.prototype.appendProfile=function(t){if(t){var i={};for(var n in t)"string"==typeof t[n]||"Array"===Object.prototype.toString.call(t[n]).slice(8,-1)?i[n]=t[n]:console.warn("please check the value of param: ".concat(n,", must be string or array !!!"));Object.keys(i).length&&this.report("__profile_append",e(e({},i),{profile:!0}))}else console.warn("please check the params, must be object!!!")},t.prototype.pushCache=function(e){var t=this;Object.keys(e).forEach(function(i){t.cache[i]={val:t.clone(e[i]),timestamp:Date.now()}})},t.prototype.formatParams=function(e,t){var i=this;void 0===t&&(t=!1);try{if(!e||"[object Object]"!==Object.prototype.toString.call(e))return void console.warn("please check the params type, must be object !!!");var n={};for(var o in e)"string"==typeof e[o]||"number"==typeof e[o]||"Array"===Object.prototype.toString.call(e[o]).slice(8,-1)?n[o]=e[o]:console.warn("please check the value of params:".concat(o,", must be string,number,Array !!!"));var r=Object.keys(n);if(!r.length)return;var a=Date.now();return r.filter(function(n){var o=i.cache[n];return t?!o:!(o&&i.compare(o.val,e[n])&&a-o.timestamp<i.duration)}).reduce(function(e,t){return e[t]=n[t],e},{})}catch(e){this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),console.log("error")}},t.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),!1}},t.prototype.clone=function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),e}},t.prototype.unReady=function(){console.warn("sdk is not ready, please use this api after start")},t}(),pe=function(){function e(){this.setUrl="/service/2/log_settings",this.expire=216e5}return e.prototype.apply=function(e,t){if(t.enable_logsetting){this.collect=e,this.config=t;var i=e.adapters.storage;this.setKey="__applog_web_logsetting_".concat(t.app_id),this.cacheStorgae=new i(!1),this.check()}else e.emit(U.LogSettingReady)},e.prototype.check=function(){var e=this.getLocalData();e&&Object.keys(e).length?(null==e?void 0:e.timestamp)<Date.now()-this.expire?this.setting():(this.setLocalData(e),this.setting(!0)):this.setting()},e.prototype.setting=function(e){var t=this;e?this.collect.emit(U.LogSettingReady):(0,this.collect.adapters.fetch)("".concat(this.collect.configManager.getDomain()).concat(this.setUrl),{magic_tag:"ss_app_log",header:{aid:this.config.app_id,platform:"web"}},5e3,!1,function(e){console.log(e),(null==e?void 0:e.config)&&t.setLocalData(e.config),t.collect.emit(U.LogSettingReady)},function(){t.collect.emit(U.LogSettingReady)},"","",this.config.enable_encryption,this.config.encryption_header)},e.prototype.getLocalData=function(){return this.cacheStorgae.getItem(this.setKey)},e.prototype.setLocalData=function(e){this.collect.configManager.setSettingData(e),this.cacheStorgae.setItem(this.setKey,e)},e}(),fe=function(){function e(e,t){if(this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,t.enable_debug&&"Microsoft Internet Explorer"!==e.configManager.get("browser")){this.collect=e,this.config=t,this.app_id=t.app_id;var i=e.adapters.storage;this.cacheStorgae=new i(!1,"session"),this.loadUrl=t.devtool_url||"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/debug-web.v1.0.1.js",this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load()}}return e.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(e){console.log("devTool load fail, ".concat(e.message))}},e.prototype.parseUrl=function(){var e={};try{var t=window.location.href.split("?")[1].split("&");t.length&&t.forEach(function(t){var i=t.split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])})}catch(e){}return e},e.prototype.load=function(){try{this.loadBaseInfo(),this.loadHook(),this.setStorage(),this.addLintener(),this.loadDebuggerModule(),this.loadDevTool()}catch(e){console.log("debug fail, ".concat(e.message))}},e.prototype.getStorage=function(){var e=this.cacheStorgae.getItem("__applog_devtool_web");return e&&parseInt(e)===this.app_id},e.prototype.setStorage=function(){this.cacheStorgae.setItem("__applog_devtool_web",this.app_id)},e.prototype.loadDevTool=function(){this.loadScript(this.loadUrl)},e.prototype.loadBaseInfo=function(){var e=this;this.info=[{title:"基本信息",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,"上报域名":this.collect.configManager.getDomain(),"SDK版本":I,"SDK引入方式":"script"}},{title:"用户信息",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"点击获取SSID"}},{title:"公共参数信息",type:2,infoName:{"浏览器":this.collect.configManager.get("browser"),"浏览器版本":this.collect.configManager.get("browser_version"),"平台":this.collect.configManager.get("platform"),"设备型号":this.collect.configManager.get("device_model"),"操作系统":this.collect.configManager.get("os_name"),"操作系统版本":this.collect.configManager.get("os_version"),"屏幕分辨率":this.collect.configManager.get("resolution"),"来源":this.collect.configManager.get("referrer"),"自定义信息":""}},{title:"配置信息",type:3,infoName:{"全埋点":!!this.config.autotrack,"停留时长":!!this.config.enable_stay_duration}},{title:"A/B配置信息",type:4,infoName:{"A/B实验":!!this.config.enable_ab_test}},{title:"客户端信息",type:3,infoName:{"打通开关":!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(U.Ready,function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName["自定义信息"]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["已曝光VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/B域名"]=e.config.ab_channel_domain||p(L[e.config.channel]),e.info[4].infoName["全部配置"]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName["是否打通"]=!!e.collect.bridgeReport)})},e.prototype.loadHook=function(){var e=this;this.collect.on(G.DEBUGGER_MESSAGE,function(t){switch(t.type){case G.DEBUGGER_MESSAGE_SDK:var i={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(i.desc={content:JSON.stringify(t.data)}),e.updateLog(i),t.secType&&"AB"===t.secType?(e.info[4].infoName["已曝光VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["全部配置"]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case G.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var n=t.data[0],o=n.events;if(!o.length)return;o.forEach(function(i){i.checkShow=!0,i.searchShow=!0,i.success=t.status,i.type=-1!==e.filterEvent.indexOf(i.event)?"sdk":"cus",i.type=e.collect.bridgeReport?"bridge":i.type,i.info="","fail"===t.status&&(i.info={message:"code: ".concat(t.code,"， msg: ").concat(t.failType)})}),e.updateEvent(n)}return}})},e.prototype.addLintener=function(){var e=this;window.addEventListener("message",function(t){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;console.log("inittttt"),e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken(function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()})})},e.prototype.sendData=function(e,t){try{var i={type:e,payload:t};window&&window.postMessage(i,this.devToolOrigin)}catch(e){}},e.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},e.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},e.prototype.updateEvent=function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)},e.prototype.loadDebuggerModule=function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: fixed;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n      z-index:100;\n    }")),e.appendChild(t);var i=document.createElement("div");i.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web">AppLog调试</div>';var n=document.createElement("div");n.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(i),document.getElementsByTagName("body")[0].appendChild(n),document.getElementById("debugger-applog-web").addEventListener("click",function(){window&&window.postMessage({type:"devtool:web:open-draw"},location.origin)})},e}();var de=function(){function t(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.adapters={},this.sdkReady=!1,this.name=e,this.hook=new o(this),this.logger=new J(e),this.remotePlugin=new Map,this.Types=U,this.adapters.fetch=X,this.adapters.storage=x}return t.usePlugin=function(e,i,n){if(i){for(var o=!1,r=0,a=t.plugins.length;r<a;r++){if(t.plugins[r].name===i){t.plugins[r].plugin=e,t.plugins[r].options=n||{},o=!0;break}}o||t.plugins.push({name:i,plugin:e,options:n})}else t.plugins.push({plugin:e})},t.prototype.usePlugin=function(e,t,i){e&&(this.remotePlugin.get(e)?console.info("your sdk version has ".concat(e," already ~")):t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:i}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},t.prototype.init=function(e){var i,n=this;if(this.inited)console.log("init can be call only one time");else if(e&&r(e))if(e.app_id&&("number"==typeof(i=e.app_id)&&!isNaN(i)))if(!e.app_key||function(e){return"string"==typeof e}(e.app_key))if(e.channel_domain||-1!==["cn","sg","va"].indexOf(e.channel)||(console.warn("channel must be `cn`, `sg`,`va` !!!"),e.channel="cn"),this.logger=new J(this.name,e.log),this.configManager=new H(this,e),this.appBridge=new W(e,this.configManager),this.bridgeReport=this.appBridge.bridgeInject(),this.logSetting=new pe,this.debugger=new fe(this,e),this.initConfig=e,this.env=e.channel_domain?"self":"public",this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 执行INIT",data:e,level:"info",time:Date.now()}),e.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport){try{t.plugins.length&&t.plugins.reduce(function(e,t){var i=t.plugin,o=t.options;if("stay"===(null==t?void 0:t.name)||"autotrack"===(null==t?void 0:t.name)){var r=Object.assign(n.initConfig,o),a=new i;a.apply(n,r),e.push(a)}return e},this.pluginInstances)}catch(e){console.log("load plugin error, ".concat(e.message)),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}this.inited=!0,this.emit(U.Init)}else this.configManager.set({app_id:e.app_id}),this.eventManager=new oe,this.tokenManager=new ae,this.sessionManager=new ie,this.profileManager=new ue,this.extendManager=new he,Promise.all([new Promise(function(e){n.once(U.TokenComplete,function(){e(!0)})}),new Promise(function(e){n.once(U.Start,function(){e(!0)})}),new Promise(function(e){n.once(U.LogSettingReady,function(){e(!0)})})]).then(function(){n.ready(e)}).catch(function(e){console.log(e)}),this.logSetting.apply(this,e),this.tokenManager.apply(this,e),this.eventManager.apply(this,e),this.sessionManager.apply(this,e),this.inited=!0,this.emit(U.Init);else console.warn("app_key param is error, must be string, please check!");else console.warn("app_id param is error, must be number, please check!");else console.warn("init params error,please check")},t.prototype.ready=function(e){var i=this;try{this.extendManager.apply(this,this.initConfig),t.plugins.length&&t.plugins.reduce(function(e,t){var n=t.plugin,o=t.options,r=Object.assign(i.initConfig,o),a=new n;return a.apply(i,r),e.push(a),e},this.pluginInstances)}catch(e){console.log("load plugin error, ".concat(e.message)),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}this.sdkReady=!0,this.emit(U.Ready),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 初始化完成",time:Date.now(),level:"info",data:this.configManager.get("user")}),this.logger.info("appid: ".concat(e.app_id,", userInfo:").concat(JSON.stringify(this.configManager.get("user")))),this.logger.info("appid: ".concat(e.app_id,", sdk is ready, version is ").concat(I,", you can report now !!!")),this.profileManager.apply(this,e);try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}this.pageView(),this.on(U.TokenChange,function(t){"webid"!==t.type&&"anonymous_id"!==t.type||i.pageView(),i.logger.info("appid: ".concat(e.app_id," token change, new userInfo:").concat(JSON.stringify(i.configManager.get("user")))),i.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 设置了用户信息",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})}),this.on(U.TokenReset,function(){i.logger.info("appid: ".concat(e.app_id," token reset, new userInfo:").concat(JSON.stringify(i.configManager.get("user")))),i.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 重置了用户信息",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})}),this.on(U.RouteChange,function(t){t.init||e.disable_route_report||i.pageView(t.config)}),this.on(U.ReStart,function(){i.pageView()})},t.prototype.config=function(t){if(this.inited)if(t&&r(t))if(this.bridgeReport)this.appBridge.setConfig(t);else{t._staging_flag&&1===t._staging_flag&&(this.staging=!0),t.disable_auto_pv&&(this.disableAutoPageView=!0,delete t.disable_auto_pv);var i=e({},t);if(this.initConfig&&this.initConfig.configPersist){var n=this.configManager.getStore();n&&(i=Object.assign(n,t)),this.configManager.setStore(t)}i.web_id,i.user_unique_id;var o=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i}(i,["web_id","user_unique_id"]);i.hasOwnProperty("web_id")&&this.emit(U.ConfigWebId,i.web_id),i.hasOwnProperty("user_unique_id")&&this.emit(U.ConfigUuid,i.user_unique_id),this.configManager.set(o),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 执行CONFIG",level:"info",time:Date.now(),data:i})}else this.logger.warn("config params is error, please check");else this.logger.warn("config must be use after function init")},t.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(U.ConfigDomain)},t.prototype.getConfig=function(e){return this.configManager.get(e)},t.prototype.send=function(){this.start()},t.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(U.Start),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 执行START",level:"info",time:Date.now()}),this.bridgeReport&&(this.pageView(),this.emit(U.Ready)))},t.prototype.event=function(e,t){var i=this;try{if(this.initConfig&&this.initConfig.disable_track_event)return;var n=[];if(Array.isArray(e))e.forEach(function(e){var t=i.processEvent(e[0],e[1]||{});t&&n.push(t)});else{var o=this.processEvent(e,t);if(!o)return;n.push(o)}this.bridgeReport?n.forEach(function(e){var t=e.event,n=e.params;i.appBridge.onEventV3(t,JSON.stringify(n))}):n.length&&(this.emit(U.Event,n),this.emit(U.SessionResetTime))}catch(e){this.logger.warn("something error, please check"),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},t.prototype.beconEvent=function(e,t){var i=this;if(!this.initConfig||!this.initConfig.disable_track_event)if(Array.isArray(e))console.warn("beconEvent not support batch report, please check");else{var n=[],o=this.processEvent(e,t||{});o&&(n.push(o),this.bridgeReport?n.forEach(function(e){var t=e.event,n=e.params;i.appBridge.onEventV3(t,JSON.stringify(n))}):n.length&&(this.emit(U.BeconEvent,n),this.emit(U.SessionResetTime)))}},t.prototype.processEvent=function(e,t){void 0===t&&(t={});try{if(!e)return this.logger.warn("eventName is null， please check"),null;var i=e;/^event\./.test(e)&&(i=e.slice(6));var n=t;"object"!=typeof n&&(n={}),n.profile?delete n.profile:n.event_index=l();var o=void 0;return n.local_ms?(o=n.local_ms,delete n.local_ms):o=+new Date,{event:i,params:n,local_time_ms:o,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(i){return this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:i.message}),{event:e,params:t}}},t.prototype.dynamicParams=function(e){this.dynamicParamsFilter=e},t.prototype.filterEvent=function(e){this.eventFilter=e},t.prototype.on=function(e,t){this.hook.on(e,t)},t.prototype.once=function(e,t){this.hook.once(e,t)},t.prototype.off=function(e,t){this.hook.off(e,t)},t.prototype.emit=function(e,t,i){this.hook.emit(e,t,i)},t.prototype.set=function(e){this.hook.set(e)},t.prototype.pageView=function(e){this.disableAutoPageView||this.predefinePageView(e)},t.prototype.predefinePageView=function(t){if(void 0===t&&(t={}),this.inited){var i={title:document.title||location.pathname,url:location.href,url_path:this.handlePath(),time:Date.now(),referrer:window.document.referrer,$is_first_time:"".concat(this.configManager&&this.configManager.is_first_time||!1)},n=e(e({},i),t);this.event("predefine_pageview",n)}else console.warn("predefinePageView should call after init")},t.prototype.handlePath=function(){var e=location.pathname;try{if(this.initConfig.allow_hash){var t=new URL(location.href).hash.match(/#\/([^?#]+)/i);return t&&t.length?t[1]:location.pathname}}catch(t){e=location.pathname}return e},t.prototype.clearEventCache=function(){this.emit(U.CleanEvents)},t.prototype.setWebIDviaUnionID=function(e){if(e){var t=y(e);this.config({web_id:"".concat(t),wechat_unionid:e}),this.emit(U.CustomWebId)}},t.prototype.setWebIDviaOpenID=function(e){if(e){var t=y(e);this.config({web_id:"".concat(t),wechat_openid:e}),this.emit(U.CustomWebId)}},t.prototype.setAnonymousId=function(e){this.emit(U.AnonymousId,e)},t.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},t.prototype.resetStayDuration=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.emit(U.ResetStay,{url_path:e,title:t,url:i},U.Stay)},t.prototype.resetStayParams=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.emit(U.SetStay,{url_path:e,title:t,url:i},U.Stay)},t.prototype.getToken=function(t,i){var n=this;if(this.inited){var o=!1,r=function(i){if(!o){o=!0;var r=n.configManager.get().user;return i&&(r.tobid=i,r["diss".split("").reverse().join("")]=i),t(e({},r))}},a=function(){n.tokenManager.getTobId(function(e){r(e)})};this.sdkReady?a():(i&&setTimeout(function(){r()},i),this.on(U.Ready,function(){a()}))}else this.logger.warn("getToken must be use after function init")},t.prototype.setResourceEvent=function(e){this.emit(U.SetResource,e)},t.prototype.startTrackEvent=function(e){e&&this.emit(U.TrackDurationStart,e,U.TrackDuration)},t.prototype.endTrackEvent=function(e,t){void 0===t&&(t={}),e&&this.emit(U.TrackDurationEnd,{eventName:e,params:t},U.TrackDuration)},t.prototype.pauseTrackEvent=function(e){e&&this.emit(U.TrackDurationPause,e,U.TrackDuration)},t.prototype.resumeTrackEvent=function(e){e&&this.emit(U.TrackDurationResume,e,U.TrackDuration)},t.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(U.ProfileSet,e,U.Profile),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSet",level:"info",time:Date.now(),data:e})},t.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(U.ProfileSetOnce,e,U.Profile),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSetOnce",level:"info",time:Date.now(),data:e})},t.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(U.ProfileIncrement,e,U.Profile),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileIncrement",level:"info",time:Date.now(),data:e})},t.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(U.ProfileUnset,e,U.Profile),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileUnset",level:"info",time:Date.now(),data:e})},t.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(U.ProfileAppend,e,U.Profile),this.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileAppend",level:"info",time:Date.now(),data:e})},t.prototype.setExternalAbVersion=function(e){this.bridgeReport?this.appBridge.setExternalAbVersion(e):this.emit(U.AbExternalVersion,"string"==typeof e&&e?"".concat(e).trim():null,U.Ab)},t.prototype.getVar=function(e,t,i){this.bridgeReport?this.appBridge.getVar(e,t,i):this.emit(U.AbVar,{name:e,defaultValue:t,callback:i},U.Ab)},t.prototype.getAllVars=function(e){this.bridgeReport?this.appBridge.getAllVars(e):this.emit(U.AbAllVars,e,U.Ab)},t.prototype.getABconfig=function(e,t){this.emit(U.AbConfig,{params:e,callback:t},U.Ab)},t.prototype.getAbSdkVersion=function(e){if(!this.bridgeReport||!e)return this.configManager.getAbVersion()||"";this.appBridge.getAbSdkVersion(e)},t.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(U.AbVersionChangeOn,e,U.Ab),function(){t.emit(U.AbVersionChangeOff,e,U.Ab)}},t.prototype.offAbSdkVersionChange=function(e){this.emit(U.AbVersionChangeOff,e,U.Ab)},t.prototype.openOverlayer=function(){this.emit(U.AbOpenLayer,"",U.Ab)},t.prototype.closeOverlayer=function(){this.emit(U.AbCloseLayer,"",U.Ab)},t.prototype.initCrypto=function(){this.publicKey=this.initConfig.crypto_publicKey||"04BA9E229380DC0E41E10839B0C52A4763D3EDFE8903F3B8E81395523381E03AA995D295BD4A4088792E4785B224F7837EB4D2C7C05973C7AE8687A35ACAE470A0"},t.prototype.cryptoData=function(e){return e},t.prototype.stop=function(){this.sdkStop=!0},t.prototype.reStart=function(){this.sdkStop=!1,this.emit(U.ReStart)},t.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(U.TokenComplete))},t.prototype.destoryInstance=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(U.TokenComplete))},t.prototype.setExposureType=function(e){this.emit(U.SetExposureType,e)},t.plugins=[],t}(),ge="__rangers_ab_style__";!function(e){var t=function(){try{return!!Symbol.iterator}catch(e){return!1}}(),i=function(e){var i={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t&&(i[Symbol.iterator]=function(){return i}),i},n=function(e){return encodeURIComponent(e).replace(/%20/g,"+")},o=function(e){return decodeURIComponent(String(e).replace(/\+/g," "))};(function(){try{var t=e.URLSearchParams;return"a=1"===new t("?a=1").toString()&&"function"==typeof t.prototype.set&&"function"==typeof t.prototype.entries}catch(t){return!1}})()||function(){var o=function e(t){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var i=typeof t;if("undefined"===i);else if("string"===i)""!==t&&this._fromString(t);else if(t instanceof e){var n=this;t.forEach(function(e,t){n.append(t,e)})}else{if(null===t||"object"!==i)throw new TypeError("Unsupported input's type for URLSearchParams");if("[object Array]"===Object.prototype.toString.call(t))for(var o=0;o<t.length;o++){var r=t[o];if("[object Array]"!==Object.prototype.toString.call(r)&&2===r.length)throw new TypeError("Expected [string, any] as entry at index "+o+" of URLSearchParams's input");this.append(r[0],r[1])}else for(var a in t)t.hasOwnProperty(a)&&this.append(a,t[a])}},r=o.prototype;r.append=function(e,t){e in this._entries?this._entries[e].push(String(t)):this._entries[e]=[String(t)]},r.delete=function(e){delete this._entries[e]},r.get=function(e){return e in this._entries?this._entries[e][0]:null},r.getAll=function(e){return e in this._entries?this._entries[e].slice(0):[]},r.has=function(e){return e in this._entries},r.set=function(e,t){this._entries[e]=[String(t)]},r.forEach=function(e,t){var i;for(var n in this._entries)if(this._entries.hasOwnProperty(n)){i=this._entries[n];for(var o=0;o<i.length;o++)e.call(t,i[o],n,this)}},r.keys=function(){var e=[];return this.forEach(function(t,i){e.push(i)}),i(e)},r.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),i(e)},r.entries=function(){var e=[];return this.forEach(function(t,i){e.push([i,t])}),i(e)},t&&(r[Symbol.iterator]=r.entries),r.toString=function(){var e=[];return this.forEach(function(t,i){e.push(n(i)+"="+n(t))}),e.join("&")},e.URLSearchParams=o}();var r=e.URLSearchParams.prototype;"function"!=typeof r.sort&&(r.sort=function(){var e=this,t=[];this.forEach(function(i,n){t.push([n,i]),e._entries||e.delete(n)}),t.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),e._entries&&(e._entries={});for(var i=0;i<t.length;i++)this.append(t[i][0],t[i][1])}),"function"!=typeof r._fromString&&Object.defineProperty(r,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(e){if(this._entries)this._entries={};else{var t=[];this.forEach(function(e,i){t.push(i)});for(var i=0;i<t.length;i++)this.delete(t[i])}var n,r=(e=e.replace(/^\?/,"")).split("&");for(i=0;i<r.length;i++)n=r[i].split("="),this.append(o(n[0]),n.length>1?o(n[1]):"")}})}(void 0!==S?S:"undefined"!=typeof window?window:"undefined"!=typeof self?self:S),function(e){if(function(){try{var t=new e.URL("b","http://a");return t.pathname="c d","http://a/c%20d"===t.href&&t.searchParams}catch(t){return!1}}()||function(){var t=e.URL,i=function t(i,n){"string"!=typeof i&&(i=String(i)),n&&"string"!=typeof n&&(n=String(n));var o,r=document;if(n&&(void 0===e.location||n!==e.location.href)){n=n.toLowerCase(),(o=(r=document.implementation.createHTMLDocument("")).createElement("base")).href=n,r.head.appendChild(o);try{if(0!==o.href.indexOf(n))throw new Error(o.href)}catch(t){throw new Error("URL unable to set base "+n+" due to "+t)}}var a=r.createElement("a");a.href=i,o&&(r.body.appendChild(a),a.href=a.href);var s=r.createElement("input");if(s.type="url",s.value=i,":"===a.protocol||!/:/.test(a.href)||!s.checkValidity()&&!n)throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:a});var c=new e.URLSearchParams(this.search),l=!0,h=!0,u=this;["append","delete","set"].forEach(function(e){var t=c[e];c[e]=function(){t.apply(c,arguments),l&&(h=!1,u.search=c.toString(),h=!0)}}),Object.defineProperty(this,"searchParams",{value:c,enumerable:!0});var p=void 0;Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==p&&(p=this.search,h&&(l=!1,this.searchParams._fromString(this.search),l=!0))}})},n=i.prototype;["hash","host","hostname","port","protocol"].forEach(function(e){!function(e){Object.defineProperty(n,e,{get:function(){return this._anchorElement[e]},set:function(t){this._anchorElement[e]=t},enumerable:!0})}(e)}),Object.defineProperty(n,"search",{get:function(){return this._anchorElement.search},set:function(e){this._anchorElement.search=e,this._updateSearchParams()},enumerable:!0}),Object.defineProperties(n,{toString:{get:function(){var e=this;return function(){return e.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(e){this._anchorElement.href=e,this._updateSearchParams()},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(e){this._anchorElement.pathname=e},enumerable:!0},origin:{get:function(){var e={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol],t=this._anchorElement.port!=e&&""!==this._anchorElement.port;return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(t?":"+this._anchorElement.port:"")},enumerable:!0},password:{get:function(){return""},set:function(e){},enumerable:!0},username:{get:function(){return""},set:function(e){},enumerable:!0}}),i.createObjectURL=function(e){return t.createObjectURL.apply(t,arguments)},i.revokeObjectURL=function(e){return t.revokeObjectURL.apply(t,arguments)},e.URL=i}(),void 0!==e.location&&!("origin"in e.location)){var t=function(){return e.location.protocol+"//"+e.location.hostname+(e.location.port?":"+e.location.port:"")};try{Object.defineProperty(e.location,"origin",{get:t,enumerable:!0})}catch(i){setInterval(function(){e.location.origin=t()},100)}}}(void 0!==S?S:"undefined"!=typeof window?window:"undefined"!=typeof self?self:S);var me={},ve=[],_e=function(e){e.length&&e.forEach(function(e){ve.push(e)})};function ye(e,t,i,n){var o=e&&e.source||window.opener||window.parent,r=e&&e.origin||n||"*",a={type:t,payload:i};o.postMessage(JSON.stringify(a),r)}function be(e,t){me[e]=me[e]||[],me[e].push(t)}function Ee(e){if(ve.some(function(e){return"*"===e})||ve.some(function(t){return e.origin.indexOf(t)>-1})){var t=e.data;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(e){t=void 0}if(!t)return;var i=t.type,n=t.payload;me[i]&&me[i].forEach(function(t){"function"==typeof t&&t(e,n)})}}function we(e,t){var i={};if(Object.keys(e).length)for(var n in e){if("filter"===n||"autotrack"===n||"enable_stay_duration"===n)break;i[n]=e[n]}(window.opener||window.parent).postMessage({type:"tea:sdk:info",config:i,version:t},"*"),window.addEventListener("message",Ee,!1)}var Se="",ke=!1;function Te(e){var t=e.event,i=e.editorUrl;e.collectInstance,e.fromSession;ke||(ke=!0,d(i,function(){ye(t,"abEditorScriptloadSuccess")},function(){t&&ye(t,"abEditorScriptloadError"),ke=!1}))}var Ae;!function(e){e[e.Var=0]="Var",e[e.All=1]="All"}(Ae||(Ae={}));var Oe=function(){function t(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[],this.auto_exposure=!1}return t.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,this.config.enable_ab_test){var n=e.configManager.getSettingData("bav_ab_config");if(!s(n)||n){var o=t.enable_multilink,r=t.ab_channel_domain,a=t.enable_ab_visual,c=t.ab_cross,l=t.ab_cookie_domain,h=t.disable_ab_reset,u=t.auto_exposure_expriment,f=r||p(L[t.channel||"cn"]),d=e.adapters,g=d.storage,m=d.fetch;this.cacheStorgae=new g(!1),this.fetch=m,this.enable_multilink=o,this.enable_ab_visual=a,this.abKey="__tea_sdk_ab_version_".concat(t.app_id),this.ab_cross=c,this.ab_cookie_domain=l||"",this.fetchUrl="".concat(f).concat("/service/2/abtest_config/"),this.reportUrl="".concat(e.configManager.getUrl("event")),this.exposureLimit=t.exposure_limit||5,this.ab_batch_time=t.ab_batch_time||50,this.overlay_opacity=t.overlay_opacity||0,this.auto_exposure=u;var v=this.collect.Types;this.types=v;var _=e.configManager.getSettingData("bav_ab_refresh");this.collect.on(v.TokenChange,function(e){h||s(n)&&!_||"uuid"===e.type&&i.readyStatus&&(i.clearCache(),i.fetchAB())}),this.collect.on(v.TokenReset,function(){h||s(n)&&!_||i.readyStatus&&(i.clearCache(),i.fetchAB())}),this.collect.on(v.AbVar,function(e){var t=e.name,n=e.defaultValue,o=e.callback;i.getVar(t,n,o)}),this.collect.on(v.AbAllVars,function(e){i.getAllVars(e)}),this.collect.on(v.AbConfig,function(e){var t=e.params,n=e.callback;i.getABconfig(t,n)}),this.collect.on(v.AbExternalVersion,function(e){i.setExternalAbVersion(e)}),this.collect.on(v.AbOpenLayer,function(){i.openOverlayer()}),this.collect.on(v.AbCloseLayer,function(){i.closeOverlayer()}),this.collect.on(v.AbVersionChangeOn,function(e){i.changeListener.set(e,e)}),this.collect.on(v.AbVersionChangeOff,function(e){i.changeListener.get(e)&&i.changeListener.delete(e)}),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(v.AbReady)}}},t.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach(function(i){t.collect.hook.emit(e,i)})};for(var o in i)n(o)}},t.prototype.loadMode=function(){var e,t,i=function(){try{var e=JSON.parse(atob(window.name));return e||void 0}catch(e){return}}(),n="";if(i){var o=i.scenario,r=i.href;o?(this.editMode=!0,n=o):!r||-1===r.indexOf("datatester")&&-1===r.indexOf("visual-editor")||(this.editMode=!0,n="visual-editor")}this.enable_ab_visual&&(function(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{},_e(["*"]);var i,n="";we(t,I);var o="";try{var r=window.performance.getEntriesByType("resource");if(r&&r.length&&(r.forEach(function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(o=e.name)}),o||document.currentScript&&(o=document.currentScript.src),o&&(i=o.split("/"))&&i.length)){n="https:/";for(var a=2;a<i.length&&a!==i.length-1;a++)n+="/".concat(i[a]);n="".concat(n,"/visual-ab-core")}}catch(e){}be("tea:openVisualABEditor",function(i){var o=i.data;if("string"==typeof i.data)try{o=JSON.parse(i.data)}catch(e){o=void 0}if(o){var r=o.lang;if(o.appId!==t.app_id)return ye(i,"appIdError"),void console.error("abtest appid is not belong the page appid please check");var a=o.version;if(a){var s=a?".".concat(a):".1.0.1";Se=n?"".concat(n).concat(s,".js?query=").concat(Date.now()):"".concat(P,"?query=").concat(Date.now())}else Se="".concat(P,"?query=").concat(Date.now());window.TEAVisualEditor.lang=r,window.TEAVisualEditor.__ab_domin=t.channel_domain||"",Te({event:i,editorUrl:Se,collectInstance:e})}})}(this.collect,this.config),"visual-editor"===n)?this.collect.destoryInstace():this.enable_multilink&&(e=this.collect,t=this.config,window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.appId=t.app_id,be("tea:openTesterEventInspector",function(t){var i=t.data;if("string"==typeof t.data)try{i=JSON.parse(t.data)}catch(e){i=void 0}if(i){var n=i.referrer,o=i.lang,r=i.appId;window.TEAVisualEditor.__editor_ajax_domain=n||"",window.TEAVisualEditor.__ab_appId=r||"",window.TEAVisualEditor.lang=o||"",Te({event:t,editorUrl:"".concat("https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/tester-event-inspector",".js?query=").concat(Date.now()),collectInstance:e})}}))},t.prototype.checkLocal=function(){var e=this.getABCache(),t=e.ab_version,i=e.ab_ext_version,n=e.ab_version_multilink,o=e.data,r=this.checkFromUrl();r?this.mulilinkVersions.push(r):this.mulilinkVersions=n||[],this.extVersions=i||[],this.versions=t||[],this.data=o;var a=this.versions.concat(this.extVersions);this.enable_multilink&&(a=a.concat(this.mulilinkVersions)),this.configVersions(a.join(","))},t.prototype.checkFromUrl=function(){var e=_(window.location.href);return e&&e.vid?e.vid:""},t.prototype.updateVersions=function(){var e=this.extVersions.length?this.versions.concat(this.extVersions):this.versions;this.enable_multilink&&(e=e.concat(this.mulilinkVersions)),this.configVersions(e.join(",")),this.updateABCache(),this.changeListener.size>0&&this.changeListener.forEach(function(t){"function"==typeof t&&t(e)})},t.prototype.configVersions=function(e){this.collect.configManager.setAbVersion(e)},t.prototype.getVar=function(e,t,i){if(!e)throw new Error("variable must not be empty");if(void 0===t)throw new Error("variable no default value");if("function"!=typeof i)throw new Error("callback must be a function");var n={name:e,defaultValue:t,callback:i,type:Ae.Var};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(n,e):this.callbacks.push(n)},t.prototype.getRealVar=function(e,t){var i=e.name,n=e.defaultValue,o=e.callback,a=this.data;if(a){if(r(a[i])){var s=a[i].vid;return"$ab_url"===t?this.mulilinkVersions.includes(s)||this.mulilinkVersions.push(s):this.versions.includes(s)||this.versions.push(s),this.updateVersions(),this.fechEvent(s,t,n),o(a[i].val),void this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 曝光了实验".concat(i),level:"info",time:Date.now(),data:a[i]})}this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用getVar",level:"info",time:Date.now(),data:n}),o(n)}else o(n)},t.prototype.getAllVars=function(e){if("function"!=typeof e)throw new Error("callback must be a function");var t={callback:e,type:Ae.All};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(t):this.callbacks.push(t)},t.prototype.getRealAllVars=function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用getAllVars",level:"info",time:Date.now(),data:this.data})},t.prototype.exposureAll=function(e){try{if(Object.keys(e).length)for(var t in e){if("$ab_url"===t||"$ab_modification"===t)break;this.getRealVar({name:t,defaultValue:e[t].val,callback:function(){},type:Ae.Var},t)}}catch(e){console.warn("exposure all expriment err",JSON.stringify(e.message))}},t.prototype.fechEvent=function(e,t,i){try{if(this.config.disable_track_event)return;if(this.collect.sdkStop)return;if(!e)return;var n=this.collect.configManager.get(),o=n.header,r=n.user,a=this.getABCache();if(a&&a.uuid&&a.uuid!==r.user_unique_id)return;var s={event:"abtest_exposure",ab_sdk_version:"".concat(e),params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===t?i:window.location.href}),local_time_ms:Date.now()};o.custom=JSON.stringify(o.custom);var c={events:[s],user:r,header:o};"$ab_url"===t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify([c])):this.reportExposure(c)}catch(e){this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},t.prototype.reportExposure=function(e){this.exposureCache.push(e),this.report()},t.prototype.report=function(){var e=this;try{var t=this.collect.cryptoData(this.exposureCache);if(b())return void Z(this.collect.configManager.getUrl("img"),t);this.fetch(this.reportUrl,t,1e5,!1,function(){},function(){},"","POST",this.config.enable_encryption,this.config.encryption_header),this.exposureCache.forEach(function(t){e.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:[t],code:200,status:"success"})}),this.exposureCache=[]}catch(e){console.log("ab report err",e)}},t.prototype.setExternalAbVersion=function(e){this.extVersions=[e],this.updateVersions()},t.prototype.getABconfig=function(e,t){var i=Object.keys(e);i&&i.length&&this.collect.configManager.set(e),this.fetchAB(t)},t.prototype.get=function(e){if(this.ab_cross){var t=this.cacheStorgae.getCookie(e,this.ab_cookie_domain);return t?JSON.parse(t):null}return this.cacheStorgae.getItem(e)},t.prototype.set=function(e,t){this.ab_cross?this.cacheStorgae.setCookie(e,t,2592e6,this.ab_cookie_domain):this.cacheStorgae.setItem(e,t),this.collect.configManager.setAbCache(t)},t.prototype.remove=function(){this.ab_cross?this.cacheStorgae.removeCookie(this.abKey,this.ab_cookie_domain):this.cacheStorgae.removeItem(this.abKey)},t.prototype.getABCache=function(e){var t={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""};return t=this.get(this.abKey)||t,e?t[e]:t},t.prototype.updateABCache=function(){var e=this.getABCache();e.ab_version_multilink=this.mulilinkVersions,e.ab_ext_version=this.extVersions,e.ab_version=this.versions,e.timestamp=Date.now(),this.set(this.abKey,e)},t.prototype.setAbCache=function(e){var t=this.getABCache();t.data=this.data,t.uuid=e,t.timestamp=Date.now(),this.set(this.abKey,t)},t.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[],this.collect.configManager.clearAbCache()},t.prototype.openOverlayer=function(e){var t=this;if(function(e){if(!document.getElementById(ge)){var t="body { opacity: ".concat(e," !important; }"),i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.id=ge,n.type="text/css",n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),i.appendChild(n)}}(this.overlay_opacity),e)var i=setTimeout(function(){t.closeOverlayer(),clearTimeout(i)},e)},t.prototype.closeOverlayer=function(){var e;(e=document.getElementById(ge))&&e.parentElement.removeChild(e)},t.prototype.fetchComplete=function(e,t){var i=this;if(e&&"[object Object]"==Object.prototype.toString.call(e)){this.data=e,this.setAbCache(t);var n=[];Object.keys(e).forEach(function(t){var i=e[t].vid;i&&n.push(i)}),this.versions=this.versions.filter(function(e){return n.includes(e)});var o=e.$ab_url,r=e.$ab_modification;if(r&&r.val&&this.enable_ab_visual){if(this.collect.destroyInstance)return;this.getVar("$ab_modification",window.location.href,function(){var e;e=r.val,window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.__ab_config=e,d("".concat("https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-ab-loader.js","?query=").concat(Date.now()),function(){console.log("load visual render success")},function(){console.log("load visual render fail")}),i.closeOverlayer()})}else if(o&&this.enable_multilink){this.mulilinkVersions=this.mulilinkVersions.filter(function(e){return n.includes(e)});var a=o.val,s=o.vid;a&&s&&this.getVar("$ab_url",a,function(){i.editMode||(a!==window.location.href?setTimeout(function(){if(!i.collect.destroyInstance){var e="".concat(a);e=-1===e.indexOf("http")?"https://".concat(e):e;var t=v(e).host;try{var n=new URL(e);t!==location.host?n.searchParams.append("vid",s):window.history.replaceState("","",e),window.location.href=n.href}catch(t){window.location.href=e}}},100):i.closeOverlayer())})}this.auto_exposure&&this.exposureAll(e),this.updateVersions()}else this.closeOverlayer();this.callbacks.forEach(function(e){return i[e.type===Ae.Var?"getRealVar":"getRealAllVars"](e,"")}),this.callbacks=[]},t.prototype.fetchAB=function(t){var i=this,n=this.collect.configManager.get(),o=n.header,r=n.user;this.config.enable_anonymousid&&delete r.web_id;var a=r.user_unique_id,s={header:e(e(e({aid:this.config.app_id},r||{}),o||{}),{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:window.location.href})};this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 发起AB实验请求",level:"info",logType:"fetch",time:Date.now(),data:s});var c=this.collect.cryptoData(s);this.fetch(this.fetchUrl,c,this.config.ab_timeout||3e3,!1,function(e){i.fetchStatus="complete",i.refreshFetchStatus="complete";var n=e.data;"success"===e.message?(i.fetchComplete(n,a),t&&t(n)):(i.fetchComplete(null,a),t&&t(null)),i.collect.emit(i.types.AbComplete,n),i.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求成功",level:"info",logType:"fetch",time:Date.now(),data:n})},function(){i.fetchStatus="complete",i.refreshFetchStatus="complete",i.fetchComplete(null,a),t&&t(null),i.collect.emit(i.types.AbTimeout),i.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求网络异常",level:"error",logType:"fetch",time:Date.now()})},"","",this.config.enable_encryption,this.config.encryption_header)},t}();try{var De=ce();De&&(De.LogAb=function(e,t){(new Oe).apply(e,t)})}catch(e){console.log(e)}var xe=function(){function t(e,t){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=e,this.config=t,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,r(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration))}return t.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},t.prototype.resetParams=function(e,t,i){this.url_path=e,this.url=i,this.title=t},t.prototype.enable=function(e,t,i){this.url_path=e||this.url_path,this.url=i||this.url,this.title=t||this.title,this.disableCallback=this.enablePageAlive(),this.options.params instanceof Function?this.customParmas=this.options.params():this.customParmas=this.options.params},t.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},t.prototype.sendEvent=function(t,i){void 0===i&&(i=!1);var n=i?this.aliveDTime:Date.now()-this.sessionStartTime;n<0||n>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,e({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:n,is_support_visibility_change:g(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:t},this.customParmas)),this.sessionStartTime=Date.now(),this.resetParams(location.pathname,document.title,location.href))},t.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},t.prototype.setUpTimer=function(){var e=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval(function(){Date.now()-e.sessionStartTime>e.aliveDTime&&e.sendEvent(!1,!0)},1e3)},t.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},t.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},t.prototype.enablePageAlive=function(){var e=this;this.timerHandler=this.setUpTimer();var t=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return h(document,"visibilitychange",t,!1),h(window,"pagehide",i,!1),function(){e.beforeunload(),u(document,"visibilitychange",t,!1),u(window,"beforeunload",i,!1),u(window,"pagehide",i,!1)}},t}(),Me=function(){function t(e,t){var i=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?i.activeEndTime=Date.now():"visible"===document.visibilityState&&(i.activeEndTime&&(i.totalTime+=i.activeEndTime-i.activeStartTime,i.activeTimes+=1),i.activeEndTime=void 0,i.activeStartTime=Date.now())},this.beforeunload=function(){if(i.totalTime+=(i.activeEndTime||Date.now())-i.activeStartTime,i.config.autotrack){try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:i.totalTime,page_title:document.title||location.pathname}))}catch(e){}}i.sendEventPageClose()},this.collect=e,this.config=t,this.maxDuration=t.maxDuration||864e5,this.pageStartTime=Date.now(),r(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.resetData()}return t.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},t.prototype.resetParams=function(e,t,i){this.url_path=e,this.url=i,this.title=t},t.prototype.enable=function(e,t,i){this.url_path=e||this.url_path,this.url=i||this.url,this.title=t||this.title,this.disableCallback=this.enablePageClose()},t.prototype.disable=function(){this.disableCallback()},t.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0,this.options.params instanceof Function?this.customParmas=this.options.params():this.customParmas=this.options.params,this.resetParams(location.pathname,document.title,location.href)},t.prototype.sendEventPageClose=function(){var t=Date.now()-this.pageStartTime;this.totalTime<0||t<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,e({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:t,is_support_visibility_change:g()},this.customParmas)),this.pageStartTime=Date.now(),this.resetData())},t.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},t.prototype.enablePageClose=function(){var e=this,t=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},t}(),Ce=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,this.config.enable_stay_duration){this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new xe(e,t),this.pageClose=new Me(e,t);var n=this.collect.Types;this.collect.on(n.ResetStay,function(e){var t=e.url_path,n=e.title,o=e.url;i.resetStayDuration(t,n,o)}),this.collect.on(n.RouteChange,function(e){e.init||t.disable_route_report||i.resetStayDuration()}),this.collect.on(n.SetStay,function(e){var t=e.url_path,n=e.title,o=e.url;i.setStayParmas(t,n,o)}),this.enable(this.url_path,this.title,this.url),this.ready(n.Stay),this.collect.emit(n.StayReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach(function(i){t.collect.hook.emit(e,i)})};for(var o in i)n(o)}},e.prototype.enable=function(e,t,i){this.pageAlive.enable(e,t,i),this.pageClose.enable(e,t,i)},e.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},e.prototype.setStayParmas=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.pageAlive.setParams(e,t,i),this.pageClose.setParams(e,t,i),this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayParams",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},e.prototype.reset=function(e,t,i){this.disable(),this.enable(e,t,i)},e.prototype.resetStayDuration=function(e,t,i){this.reset(e,t,i),this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayDuration",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},e}();try{var Ie=ce();Ie&&(Ie.LogStay=function(e,t){(new Ce).apply(e,t)})}catch(e){console.log(e)}var Re=function(){function e(){var e=this;this.setInterval=function(){e.clearIntervalFunc=m(function(){e.isSessionhasEvent&&e.endCurrentSession()},e.sessionInterval)},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,!t.disable_heartbeat){this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval();var n=this.collect.Types;this.collect.on(n.SessionResetTime,function(){i.process()})}},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},e.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},e}(),Ge=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,!this.config.channel_domain&&!(this.config.disable_track_event||this.config.disable_sdk_monitor||this.config.enable_encryption)){var n=e.adapters.fetch;this.fetch=n,this.url=e.configManager.getUrl("event");var o=this.collect.Types;this.collect.on(o.Ready,function(){i.sdkOnload()}),this.collect.on(o.SubmitError,function(e){var t=e.type,n=e.eventData,o=e.errorCode;"f_data"===t&&i.sdkError(n,o)})}},e.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),i=t.header,n=t.user,o=i.app_id,r=i.app_name,a=i.sdk_version,s=n.web_id,c=n.anonymous_id,l={events:[{event:"onload",params:JSON.stringify({app_id:o,app_name:r||"",sdk_version:a,sdk_type:"script",sdk_config:this.config,sdk_desc:"TOB"}),local_time_ms:Date.now()}],user:{user_unique_id:this.config.enable_anonymousid?c:s},header:{}};setTimeout(function(){e.fetch(e.url,[l],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(e){}},e.prototype.sdkError=function(e,t){var i=this;try{var n=e[0],o=n.user,r=n.header,a=[];e.forEach(function(e){e.events.forEach(function(e){a.push(e)})});var s={events:a.map(function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:r.app_id,app_name:r.app_name||"",error_event:e.event,sdk_version:r.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(r),user:JSON.stringify(o)}),local_time_ms:Date.now()}}),user:{user_unique_id:o.user_unique_id},header:{}};setTimeout(function(){i.fetch(i.url,[s],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(e){}},e}();function Le(e,t){if(void 0===t&&(t="list"),!e)return!1;if(t&&"list"===t){if(["LI","TR","DL"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaIdx"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-idx"))return!0}else{if(["A","BUTTON"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaContainer"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-container"))return!0;if(e.hasAttribute&&je(e,"ss"))return!0}return!1}var Ne=function(e,t){return!!je(e,t)};function Pe(e){for(var t=e;t&&!Le(t,"container");){if("HTML"===t.nodeName||"BODY"===t.nodeName)return e;t=t.parentElement}return t||e}var Be=function(e){if(!e)return"";var t="";return e.textContent?t=e.textContent.trim():e.innerText&&(t=e.innerText.trim()),"input"!==e.tagName&&"INPUT"!==e.tagName||(t=e.value||""),t};function Ue(e){for(var t=e;t&&t.parentNode;){if(t.hasAttribute("data-tea-ignore"))return!0;if("HTML"===t.nodeName||"body"===t.nodeName)return!1;t=t.parentNode}return!1}var Ve=function(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0},je=function(e,t){if("string"==typeof t)return Ve(e,t);if(a(t)){for(var i=!1,n=0;n<t.length;n++){if(Ve(e,t[n])){i=!0;break}}return i}},ze=function(e,t){var i={};if("string"==typeof t)Ve(e,t)&&(i[t]=e.getAttribute(t));else if(a(t))for(var n=0;n<t.length;n++){Ve(e,t[n])&&(i[t[n]]=e.getAttribute(t[n]))}return i},Ke=function(e){if(e.children.length){var t=e.children;return![].slice.call(t).some(function(e){return e.children.length>0})}return!0},qe=function(e){if("svg"===e.tagName.toLowerCase())return!0;for(var t=e.parentElement,i=!1;t;)"svg"===t.tagName.toLowerCase()?(t=null,i=!0):t=t.parentElement;return i};var He=function(){function t(t,i,n){var o=this;this.clickEvent=function(e){(function(e,t){if(1!==e.nodeType)return!1;if(!t.svg&&qe(e))return!1;if(["HTML","BODY"].includes(e.tagName.toUpperCase()))return!1;var i=e;return!!("none"!==i.style.display&&(Le(i,"container")||t.track_attr&&Ne(i,t.track_attr)||Ke(i)))})(e.target,o.options)&&o.eventHandel({eventType:"dom",eventName:"click"},e)},this.changeEvent=function(e){o.eventHandel({eventType:"dom",eventName:"change"},e)},this.submitEvent=function(e){o.eventHandel({eventType:"dom",eventName:"submit"},e)},this.getPageViewEvent=function(t,i){i&&"pushState"===i&&o.eventHandel({eventType:"dom",eventName:"beat"},e({beat_type:0},t)),o.eventHandel({eventType:"dom",eventName:"page_view"},t)},this.getPageLoadEvent=function(e){o.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:e})},this.config=n.getConfig().eventConfig,this.collect=i,this.options=t,this.beatTime=t.beat,this.statistics=!1}return t.prototype.init=function(e){this.eventHandel=e;var t=this.config.mode;this.addListener(t)},t.prototype.addListener=function(e){var t=this;if("proxy-capturing"===e&&(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv&&this.collect.on("route-change",function(e){var i=e.config,n=e.name;t.getPageViewEvent(i,n)}),this.config.beat)){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",function(){t.beatEvent(t.beatTime)});var i=0,n=null;window.addEventListener("scroll",function(){clearTimeout(n),n=setTimeout(o,500),i=document.documentElement.scrollTop||document.body.scrollTop});var o=function(){(document.documentElement.scrollTop||document.body.scrollTop)==i&&t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})}}catch(e){}try{var r=window.performance&&window.performance.getEntriesByType("paint");if(r&&r.length)new PerformanceObserver(function(e){var i=e.getEntries(),n=i[i.length-1],o=n.renderTime||n.loadTime;t.statistics||(t.getPageLoadEvent(o),t.statistics=!0)}).observe({entryTypes:["largest-contentful-paint"]}),setTimeout(function(){t.statistics||(t.getPageLoadEvent(r[0].startTime||0),t.statistics=!0)},2e3);else this.getPageLoadEvent(0)}catch(e){this.getPageLoadEvent(0)}}},t.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},t.prototype.beatEvent=function(e){var t=this;try{var i;this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(i=setInterval(function(){t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})},e)),f(function(){t.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),t.beatTime&&clearInterval(i)})}catch(e){}},t}(),Je={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},We=function(){function e(e,t){this.config=e,this.config.eventConfig=Object.assign(this.config.eventConfig,t)}return e.prototype.getConfig=function(){return this.config},e.prototype.setConfig=function(e){return this.config=e},e}();function Fe(e){for(var t=[];null!==e.parentElement;)t.push(e),e=e.parentElement;var i=[],n=[];return t.forEach(function(e){var t=function(e){if(null===e)return{str:"",index:0};var t=0,i=e.parentElement;if(i)for(var n=i.children,o=0;o<n.length&&n[o]!==e;o++)n[o].nodeName===e.nodeName&&t++;return{str:[e.nodeName.toLowerCase(),Le(e,"list")?"[]":""].join(""),index:t}}(e),o=t.str,r=t.index;i.unshift(o),n.unshift(r)}),{element_path:"/".concat(i.join("/")),positions:n}}function Xe(e,t,i,n){var o={},r=function(e){if(e){var t=e.getBoundingClientRect(),i=t.width,n=t.height;return{left:t.left,top:t.top,element_width:i,element_height:n}}}(t),a=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var i=e.clientX,n=e.clientY,o=t.left,r=t.top,a=i-o>=0?i-o:0,s=n-r>=0?n-r:0;return{touch_x:Math.floor(a),touch_y:Math.floor(s)}}(e,r),s=r.element_width,c=r.element_height,l=a.touch_x,h=a.touch_y,u=Fe(t),p=u.element_path,f=u.positions,d=function(e){var t=Pe(e),i=[];return function e(t){var n=function(e){var t="";return 3===e.nodeType?t=e.textContent.trim():e.dataset&&e.dataset.hasOwnProperty("teaTitle")?t=e.getAttribute("data-tea-title"):e.hasAttribute("ata-tea-title")?t=e.getAttribute("data-tea-title"):e.hasAttribute("title")?t=e.getAttribute("title"):"INPUT"===e.nodeName&&["button","submit"].includes(e.getAttribute("type"))?t=e.getAttribute("value"):"IMG"===e.nodeName&&e.getAttribute("alt")&&(t=e.getAttribute("alt")),t.slice(0,200)}(t);if(n&&-1===i.indexOf(n)&&i.push(n),t.childNodes.length>0)for(var o=t.childNodes,r=0;r<o.length;r++)8!==o[r].nodeType&&e(o[r])}(t),i}(t),g=window.performance.timing.navigationStart,m=Date.now()-g,v=f.map(function(e){return"".concat(e)}),_=null;if(window.TEAVisualEditor.getOriginXpath&&(_=window.TEAVisualEditor.getOriginXpath({xpath:p,positions:v})),o.element_path=_&&_.xpath||p,o.positions=_&&_.positions||v,n&&!n.text&&(o.texts=d,o.element_title=Be(t)),o.element_id=t.getAttribute("id")||"",o.element_class_name=t.getAttribute("class")||"",o.element_type=t.nodeType,o.element_width=Math.floor(s),o.element_height=Math.floor(c),o.touch_x=l,o.touch_y=h,o.page_manual_key="",o.elememt_manual_key="",o.since_page_start_ms=m,o.page_start_ms=g,o.page_path=location.pathname,o.page_host=location.host,i.track_attr&&Ne(t,i.track_attr)){var y=ze(t,i.track_attr);for(var b in y)o[b]=y[b]}if(i.custom_attr)try{if(Ne(t,i.custom_attr)){y=ze(t,i.custom_attr),b=decodeURIComponent(y[i.custom_attr]);var E=JSON.parse(b);if(Object.keys(E))for(var w in E)o[w]=E[w]}}catch(e){console.log("custom attr error")}var S=Pe(t);return"A"===S.tagName&&(o.href=S.getAttribute("href")),!1!==i.src&&("IMG"!==t.tagName||t.getAttribute("src").includes("base64")||(o.src=t.getAttribute("src"))),o}var $e=function(t,i,n,o,r){return e(e({event:t},Xe(i,n,o,r)),{is_html:1,page_key:window.location.href,page_title:document.title})},Qe=function(){function t(e,t){this.ignore={text:!1},this.initConfig=e,this.options=t,this.eventName=t&&"tea"===t.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"$bav2b_exposure",scroll:"$bav2b_slide"},t&&!1===t.text&&(this.ignore.text=!0),t&&t.exposure&&t.exposure.eventName&&(this.eventName.exposure=t.exposure.eventName),t&&t.scroll&&t.scroll.eventName&&(this.eventName.scroll=t.scroll.eventName)}return t.prototype.handleEvent=function(t,i){try{if(Ue(t.target))return null;var n="bav2b_click";switch(i){case"click":return n=this.eventName.click,$e(n,t,t.target,this.options,this.ignore);case"change":return e(e({},$e(n="bav2b_change",t,t.target,this.options)),function(e,t){try{if("bav2b_change"===e)return t.hasAttribute("data-tea-track")?{value:t.value}:{}}catch(e){return{}}}(n,t.target));case"submit":return $e(n="bav2b_submit",t,t.target,this.options)}}catch(e){return console.error(e),null}},t.prototype.handleViewEvent=function(e){e.event=this.eventName.page,e.page_title=document.title,e.page_total_width=window.innerWidth,e.page_total_height=window.innerHeight;try{var t=window.sessionStorage&&window.sessionStorage.getItem("_tea_cache_duration");if(t){var i=JSON.parse(t);e.refer_page_duration_ms=i?i.duration:""}e.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,e.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("page event error ".concat(JSON.stringify(e)))}return e},t.prototype.handleStatisticsEvent=function(e){var t={};t.event=this.eventName.static,t.is_html=1,t.page_key=location.href,t.refer_page_key=document.referrer||"",t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"",t.refer_page_manual_key="";try{var i=e.lcp,n=window.performance.timing,o=n.loadEventEnd-n.navigationStart;t.page_init_cost_ms=parseInt(i||(o>0?o:0)),t.page_start_ms=n.navigationStart}catch(e){console.log("page_statistics event error ".concat(JSON.stringify(e)))}return t},t.prototype.handleBeadtEvent=function(e){e.event=this.eventName.beat,e.page_key=window.location.href,e.is_html=1,e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{e.page_viewport_width=window.innerWidth,e.page_viewport_height=window.innerHeight,e.page_total_width=document.documentElement.scrollWidth,e.page_total_height=document.documentElement.scrollHeight,e.scroll_width=document.documentElement.scrollLeft+window.innerWidth,e.scroll_height=document.documentElement.scrollTop+window.innerHeight,e.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("beat event error ".concat(JSON.stringify(e)))}return e},t.prototype.handleExposureEvent=function(e,t){if(Ue(t.target))return null;var i=$e(e.event||this.eventName.exposure,t,t.target||t,this.options,this.ignore);if(i.$exposure_type=e.exposureType,this.options.exposure.callback){var n=this.options.exposure.callback(i);return n||Object.keys(n).length?n:(console.warn("exposure callback must return data!"),i)}return i},t.prototype.handleScrollEvent=function(e,t){var i=$e(e.event||this.eventName.scroll,t,t.target||t,this.options,this.ignore);if(i=Object.assign(i,e.params),!this.options.scroll.callback||(i=this.options.scroll.callback(i))||Object.keys(i).length)return i;console.warn("scroll callback must return data!")},t}(),Ye=function(){function e(e){this.collect=e}return e.prototype.send=function(e,t){var i=t.event;delete t.event,e&&"becon"===e.eventSend?this.collect.beconEvent(i,t):this.collect.event(i,t)},e.prototype.get=function(e,t){var i=Object.assign({headers:{"content-type":"application/json"},method:"GET"},t);fetch(e,i)},e.prototype.post=function(e,t){var i=Object.assign({headers:{"content-type":"application/json"},method:"POST"},t);fetch(e,i)},e}(),Ze="_TEA_VE_OPEN",et="_TEA_VE_APIHOST",tt="lang",it="_VISUAL_EDITOR_V",nt="_VISUAL_EDITOR_U";function ot(){try{var e=window.TEAVisualEditor.lang=window.TEAVisualEditor.lang||T.get(tt),t=window.TEAVisualEditor.__editor_ajax_domain=window.TEAVisualEditor.__editor_ajax_domain||T.get(et),i=window.TEAVisualEditor.__editor_verison=window.TEAVisualEditor.__editor_verison||T.get(it),n=window.TEAVisualEditor.__editor_url=window.TEAVisualEditor.__editor_url||T.get(nt),o=+new Date,r=new Date(o+18e5);T.set(Ze,"1",{expires:r}),T.set(et,t,{expires:r}),T.set(nt,n,{expires:r}),T.set(tt,e,{expires:r}),T.set(it,i||"",{expires:r})}catch(e){console.log("set cookie err")}}var rt=!1;function at(e){var t=e.event,i=e.editorUrl,n=e.autoTrackInstance;rt||(rt=!0,d(i,function(){ye(t,"editorScriptloadSuccess"),n.destroy()},function(){t&&ye(t,"editorScriptloadError"),rt=!1}))}function st(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{};var i="",n="".concat(N,"?query=").concat(Date.now());window.TEAVisualEditor.appId=t.app_id;var o=t.channel_domain,r="";if(_e(["*"]),o){var a,s="";try{var c=window.performance.getEntriesByType("resource");if(c&&c.length&&(c.forEach(function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(s=e.name)}),s||document.currentScript&&(s=document.currentScript.src),s&&(a=s.split("/"))&&a.length)){r="https:/";for(var l=2;l<a.length&&l!==a.length-1;l++)r+="/".concat(a[l]);if(r&&r.indexOf("/5.0")){var h=r.split("/5.0");r=h[0]||r}}}catch(e){}}if(we(t,I),"1"===T.get(Ze)){var u=function(){var e=T.get(et);try{e=JSON.parse(e)}catch(e){}return e}(),p="";u&&(window.TEAVisualEditor.__editor_ajax_domain=u,p=T.get(nt)),at({event:null,editorUrl:p||n,autoTrackInstance:e}),ot()}else try{be("tea:openVisualEditor",function(t){var a=t.data;if("string"==typeof t.data)try{a=JSON.parse(t.data)}catch(e){a=void 0}if(a){var s=a.referrer,c=a.lang;if(s&&(window.TEAVisualEditor.__editor_ajax_domain=s),i=n,o){var l=a.version,h=l?"/visual-editor-rangers-v".concat(l):"/visual-editor-rangers-v1.0.0";i=r?"".concat(r).concat(h,".js"):n,window.TEAVisualEditor.__editor_verison=l}window.TEAVisualEditor.__editor_url=i,window.TEAVisualEditor.lang=c,at({event:t,editorUrl:i,autoTrackInstance:e}),ot()}}),window.TEAVisualEditor.openAutotrackEditor=function(){at({event:null,editorUrl:window.TEAVisualEditor.__editor_url,autoTrackInstance:e})}}catch(e){console.log("receive message error")}try{be("tea:openHeatMapCore",function(t){at({event:t,editorUrl:"".concat(B,".js?query=").concat(Date.now()),autoTrackInstance:e})})}catch(e){console.log("openHeatMapCore error")}}var ct,lt=function(){function e(e,t){this._instance=null,this._intersection=e,this.config=t,this._intersection&&this.init()}return e.prototype.init=function(){var e=this;if(window.MutationObserver)try{if(this._instance=new MutationObserver(function(t){t.forEach(function(t){"attributes"===t.type&&e.attributeChangeObserve(t),"childList"===t.type&&e.modifyNodeObserve(t)})}),!document||!document.body)return void console.warn("please use sdk api init after body element");var t=!1!==this.config.autotrack.exposure.attributes;this._instance.observe(document.body,{childList:!0,attributes:t,subtree:!0,attributeOldValue:!1})}catch(e){console.log("your browser cannot support MutationObserver，so cannot report exposure event, please update")}else console.log("your browser cannot support MutationObserver，so cannot report exposure event, please update")},e.prototype.attributeChangeObserve=function(e){e.target.hasAttribute("data-exposure")?this.exposureAdd(e,"mutation"):this.exposureRemove(e)},e.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureAdd(e,"intersect"),t.mapChild(e,t.exposureAdd.bind(t))}),Array.prototype.forEach.call(e.removedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureRemove(e),t.mapChild(e,t.exposureRemove.bind(t))})},e.prototype.mapChild=function(e,t){var i=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t(e),i.mapChild(e,t)})},e.prototype.exposureAdd=function(e,t){try{this._intersection&&this._intersection.exposureAdd(e,t)}catch(e){console.log("intersection error",JSON.stringify(e.message))}},e.prototype.exposureRemove=function(e){try{this._intersection&&this._intersection.exposureRemove(e)}catch(e){console.log("intersection error",JSON.stringify(e.message))}},e._exposure_observer=null,e}();!function(e){e[e.EXPOSURE_ONCE=0]="EXPOSURE_ONCE",e[e.LIFECYCLE_SHOW_NEW=3]="LIFECYCLE_SHOW_NEW",e[e.RESUME_FORM_PAGE=6]="RESUME_FORM_PAGE",e[e.RESUME_FORM_BACK=7]="RESUME_FORM_BACK",e[e.NOT_EXPOSURE=-1]="NOT_EXPOSURE"}(ct||(ct={}));var ht,ut=function(){function e(t,i,n){var o=this;this.backStatus=!1,this.instance=this.buildObserver(),this.collect=t,this.observeMap=e._observer_map,i.autotrack.exposure.ratio?this.ratio=i.autotrack.exposure.ratio:0===i.autotrack.exposure.ratio?this.ratio=0:this.ratio=.5,this.timeLimit=i.autotrack.exposure.stay||0,this.exposureType=ct.NOT_EXPOSURE,this.eventHandle=n,this.hashMap=new Map,this.backStatus=!1,this.lastState=null,this.collect.on("re-start-sdk",function(){o.visibilitychange()}),this.addListen()}return e.prototype.buildObserver=function(){var t=this;if(e._observer_instance)return console.log("your browser cannot support IntersectionObserver， so cannot report exposure event, please update"),null;if(window.IntersectionObserver){for(var i=[],n=0;n<=1;n+=.01)i.push(n);i.push(1);try{e._observer_instance=new IntersectionObserver(function(e){e.forEach(function(e){var i=e.target.observeId,n=t.observeMap.get(i),o=(e.target,e.isIntersecting,e.intersectionRatio);if(n.intersectionRatio=o,o<=.1&&(e.target.backStatus=!1),t.observeMap.set(i,n),o<t.ratio)return n.isIntersecting=!1,n.added=!1,n.exposured=!1,n.startTime=Date.now(),void t.observeMap.set(i,n);if(!n.added){if(n.startTime=Date.now(),n.added=!0,n.isIntersecting=!0,t.timeLimit){var r=setTimeout(function(){try{if(n.isIntersecting&&!n.exposured&&t.observeMap.get(i)){var o=t.observeMap.get(i).intersectionRatio;t.exposureEvent(e,o,i,n)}}catch(e){console.log("IntersectionObserver setTimeout error，msg: ".concat(JSON.stringify(e)))}},t.timeLimit);n.wait=r}t.observeMap.set(i,n)}Date.now()-n.startTime>=t.timeLimit&&!n.exposured&&t.exposureEvent(e,o,i,n)})},{threshold:i})}catch(e){console.log("IntersectionObserver error，msg: ".concat(JSON.stringify(e)))}return e._observer_instance}return console.log("your browser cannot support IntersectionObserver， so cannot report exposure event, please update"),null},e.prototype.exposureAdd=function(e,t){var i="mutation"===t?e.target:e,n=i.observeId,o=re();if(n||this.observeMap.has(n)){var r=this.observeMap.get(n);if(r&&i!==r.instance)this.unobserve(i),this.observeMap.delete(n),i.observeId=o,i.visible=!1,this.observeMap.set(o,{instance:i.cloneNode(!0),isIntersecting:!1}),this.observe(i);else{if(!0===i.visible)return;this.handleBoundingExposure(i)}}else i.observeId=o,i.visible=!1,this.observeMap.set(o,{instance:i.cloneNode(!0),isIntersecting:!1}),this.observe(i)},e.prototype.exposureRemove=function(e){this.observeMap.has(e.observeId)&&(this.observeMap.delete(e.observeId),this.unobserve(e),e.observeId="",e.visible=!1)},e.prototype.exposureEvent=function(e,t,i,n){if(t>=this.ratio){if("0"===e.target.style.opacity||"hidden"===e.target.style.visibility)return;if(!0===n.exposured)return;n.startWait&&clearTimeout(n.startWait);var o=e.target.getAttribute("data-exposure-event");this.eventHandle({eventType:"dom",eventName:"exposure",event:o,exposureType:this.getExposureType(e.target)},e),e.target.visible=!0,e.target.hasExposure=!0,n.startTime=Date.now(),n.exposured=!0}else n.startTime=Date.now(),n.exposured=!1;this.observeMap.set(i,n)},e.prototype.observe=function(e){this.instance&&this.instance.observe(e)},e.prototype.unobserve=function(e){this.instance&&this.instance.unobserve(e)},e.prototype.getExposureDomToExposure=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(t){e.handleBoundingExposure(t)})},e.prototype.visibilitychange=function(){var e=this,t=null;"visible"===document.visibilityState?this.timeLimit?t=setTimeout(function(){e.getExposureDomToExposure()},this.timeLimit):this.getExposureDomToExposure():(clearTimeout(t),this.customType=void 0)},e.prototype.handleBoundingExposure=function(e){if(this.getBoundingRatio(e)>=this.ratio){e.visible=!0;var t=e.getAttribute&&e.getAttribute("data-exposure-event");this.eventHandle({eventType:"dom",eventName:"exposure",event:t,exposureType:this.customType||ct.RESUME_FORM_BACK},e)}},e.prototype.getBoundingRatio=function(e){var t=e.getBoundingClientRect(),i=t.top,n=t.left,o=t.width,r=t.height,a=window.innerWidth||document.documentElement.clientWidth,s=window.innerHeight||document.documentElement.clientHeight;return i>=0&&n>=0&&i<=s&&n<=a?(o>a?a:o)*(s-i)/(o*r):0},e.prototype.getExposureType=function(e){return e.visible?!1!==e.backStatus&&(this.backStatus||this.customType||2===window.performance.navigation.type)?this.exposureType=ct.RESUME_FORM_PAGE:this.exposureType=ct.LIFECYCLE_SHOW_NEW:(e.hasExposure,!1!==e.backStatus&&(this.backStatus||this.customType||2===window.performance.navigation.type)?this.exposureType=ct.RESUME_FORM_PAGE:this.exposureType=ct.EXPOSURE_ONCE),this.exposureType},e.prototype.addListen=function(){var e=this;this.collect.on("set-exposure-type",function(t){e.customType=t});var n=this.visibilitychange.bind(this);if(h(document,"visibilitychange",n,!1),window.addEventListener("hashchange",function(t){var i=e.hashMap.get(t.oldURL);i&&location.href===i.prev?(e.backStatus=!0,e.exposureType=ct.RESUME_FORM_PAGE):(e.backStatus=!1,e.hashMap.set(location.href,{current:t.newURL,prev:t.oldURL}))}),this.collect.bridgeReport){var o=window.history.pushState;history.pushState=function(n){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];"function"==typeof history.onpushstate&&history.onpushstate({state:n});var s=o.call.apply(o,i([history,n],t(r)));return e.lastState=n,s};var r=history.replaceState;history.replaceState=function(n){for(var o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];"function"==typeof history.onreplacestate&&history.onreplacestate({state:n});var s=r.call.apply(r,i([history,n],t(o)));return e.lastState=n,s}}else this.collect.on("STATE_CHANGE",function(t){e.lastState=t});return window.addEventListener("popstate",function(t){var i=t.state;i&&i.current&&e.lastState&&e.lastState.back&&i.current===e.lastState.back?(e.backStatus=!0,e.exposureType=ct.RESUME_FORM_PAGE):e.backStatus=!1}),function(){u(document,"visibilitychange",n,!1)}},e._observer_instance=null,e._observer_map=new Map,e}(),pt=function(){function e(e,t,i){t.autotrack&&t.autotrack.exposure&&(this._intersection=new ut(e,t,i),this._observer=new lt(this._intersection,t),this._intersection&&this._observer?this.initObserver():console.log("your browser version cannot support exposure event, please update~"))}return e.prototype.initObserver=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(t){e._intersection.exposureAdd(t,"intersect")})},e}();!function(e){e[e.SCROLL_UP=1]="SCROLL_UP",e[e.SCROLL_DOWN=2]="SCROLL_DOWN",e[e.SCROLL_LEFT=3]="SCROLL_LEFT",e[e.SCROLL_RIGHT=4]="SCROLL_RIGHT",e[e.NOT_SCROLL=-1]="NOT_SCROLL"}(ht||(ht={}));var ft,dt=function(){function e(e,t){this.distance=30,e.autotrack&&e.autotrack.scroll&&(e.autotrack.scroll.distance&&(this.distance=e.autotrack.scroll.distance),this.eventHandle=t,this.addLinstenr(),this.mutation())}return e.prototype.addLinstenr=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-scroll]"),function(t){e.scrollHandle(t)})},e.prototype.mutation=function(){var e=this;if(window.MutationObserver)try{var t=new MutationObserver(function(t){t.forEach(function(t){"childList"===t.type&&e.modifyNodeObserve(t)})});if(!document||!document.body)return void console.warn("please use sdk api init after body element");t.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1})}catch(e){console.log("your browser cannot support MutationObserver")}else console.log("your browser cannot support MutationObserver")},e.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-scroll")&&t.scrollHandle(e),t.mapChild(e,t.scrollHandle.bind(t))}),Array.prototype.forEach.call(e.removedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-scroll")&&t.scrollHandle(e,"remove"),t.mapChild(e,t.scrollHandle.bind(t))})},e.prototype.mapChild=function(e,t){var i=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,function(e){1===e.nodeType&&e.hasAttribute("data-scroll")&&t(e),i.mapChild(e,t)})},e.prototype.scrollHandle=function(e,t){var i=this;try{var n=e.scrollTop,o=e.scrollLeft,r=null,a=0,s=0,c=function(t){clearTimeout(r),r=setTimeout(function(){var r=e.scrollTop,u=e.scrollLeft,p=t.target&&t.target.getAttribute("data-scroll-event")||"";1===h||2===h?r===c&&(s=c-n,Math.abs(s)>=i.distance&&i.distance&&i.eventHandle({eventType:"dom",eventName:"scroll",event:p,params:{$direction:h,$offsetY:s,$offsetX:a}},t)):3!==h&&4!==h||u===l&&(a=l-o,Math.abs(a)>=i.distance&&i.distance&&i.eventHandle({eventType:"dom",eventName:"scroll",event:p,params:{$direction:h,$offsetY:s,$offsetX:a}},t)),n=c,o=l},100);var c=e.scrollTop,l=e.scrollLeft,h=ht.NOT_SCROLL;c>n?h=ht.SCROLL_DOWN:c<n?h=ht.SCROLL_UP:l>o?h=ht.SCROLL_LEFT:l<o&&(h=ht.SCROLL_RIGHT)};return"remove"===t?e.removeEventListener("scroll",c,!1):e.addEventListener("scroll",c,!1),function(){e.removeEventListener("scroll",c,!1)}}catch(e){console.warn("scroll event error",JSON.stringify(e))}},e}(),gt={hashTag:!1,impr:!1},mt=function(){function e(){}return e.prototype.apply=function(e,t){if(this.autoTrackStart=!1,this.collect=e,this.config=t,t.autotrack){var i=e.configManager.getSettingData("bav_log_collect");if((!s(i)||i)&&(!t.autotrack||!t.autotrack.collect_url||t.autotrack.collect_url())){var n=e.Types;this.ready(n.Autotrack),this.collect.emit(n.AutotrackReady)}}},e.prototype.ready=function(e){this.collect.set(e);var t=this.config.autotrack;t="object"==typeof t?t:{},t=Object.assign(gt,t),this.destroyed=!1,this.options=t,this.Config=new We(Je,this.options),this.Exposure=new pt(this.collect,this.config,this.handle.bind(this)),this.Scroll=new dt(this.config,this.handle.bind(this)),this.Listener=new He(t,this.collect,this.Config),this.EventHandle=new Qe(this.config,t),this.Request=new Ye(this.collect),this.autoTrackStart=!0,this.init(),st(this,this.config)},e.prototype.init=function(){this.Listener.init(this.handle.bind(this))},e.prototype.handle=function(e,t){try{if(this.config.autotrack.collect_url&&!this.config.autotrack.collect_url())return}catch(e){}this.collect.sdkStop||"dom"===e.eventType&&this.handleDom(e,t)},e.prototype.handleDom=function(e,t){try{var i=e.eventName;if("click"===i||"change"===i||"submit"===i)(a=this.EventHandle.handleEvent(t,i))&&this.Request.send({eventType:"custom"},a);else if("page_view"===i||"page_statistics"===i){var n=void 0;(n="page_view"===i?this.EventHandle.handleViewEvent(t):this.EventHandle.handleStatisticsEvent(t))&&this.Request.send({eventType:"custom"},n)}else if("beat"===i){var o=this.EventHandle.handleBeadtEvent(t),r=e.eventSend;o&&this.Request.send({eventType:"custom",eventSend:r},o)}else if("exposure"===i){(a=this.EventHandle.handleExposureEvent(e,t))&&this.Request.send({eventType:"custom"},a)}else if("scroll"===i){var a;(a=this.EventHandle.handleScrollEvent(e,t))&&this.Request.send({eventType:"custom"},a)}}catch(e){console.log("handel dom event error ".concat(JSON.stringify(e)))}},e.prototype.destroy=function(){if(!this.autoTrackStart)return console.warn("engine is undefined, make sure you have called autoTrack.start()");this.autoTrackStart=!1,this.Listener.removeListener()},e}();try{var vt=ce();vt&&(vt.LogAutoTrack=function(e,t){(new mt).apply(e,t)})}catch(e){}!function(e){e.Net="net",e.FailNet="f_net",e.FailData="f_data"}(ft||(ft={}));var _t={pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]},yt=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.ready=t.app_id&&t.enable_tracer&&!t.disable_track_event,this.ready){this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=e,this.appid=t.app_id,this.reportUrl=e.configManager.getUrl("event");var n=this.collect.Types,o=e.adapters.fetch;this.fetch=o,this.collect.on(n.Event,function(){i.addCount("log")}),this.collect.on(n.SubmitError,function(e){var t=e.type,n=e.eventDate,o=e.errorCode,r=e.response;i.addErrorCount(n,t,o,r)}),this.listener(),this.collect.emit(n.TracerReady)}},e.prototype.addCount=function(e,t,i){void 0===t&&(t="net"),void 0===i&&(i=1);try{this.tracerCache||(this.tracerCache=new Map);var n=void 0;if(this.tracerCache.has(e)){if((o=this.tracerCache.get(e)).has(t))n=o.get(t).params.count,n++,o.set(t,this.processTracer(n,e,t));else n=i,o.set(t,this.processTracer(i,e,t))}else{var o=new Map;n=i,o.set(t,this.processTracer(i,e,t)),this.tracerCache.set(e,o)}"net"===t&&n>=this.limit[e]&&this.report(!1)}catch(e){console.log(e)}},e.prototype.addErrorCount=function(e,t,i,n){var o=this;try{if(e&&e.length){var r=e[0].events;r&&r.length&&("f_data"===t?(n&&n.hasOwnProperty("sc")?this.addCount("log",t,r.length-n.sc):this.addCount("log",t,r.length),this.errorCode[t]=i):r.forEach(function(e){var n="log";for(var r in _t)if(-1!==_t[r].indexOf(e.event)){n=r;break}o.addCount(n,t,1),o.errorCode[t]=i}))}}catch(e){}},e.prototype.report=function(e){if(this.tracerCache){var t=[];this.tracerCache.forEach(function(e){console.log(e),e.forEach(function(e){t.push(e)})}),t&&t.length&&this.sendTracer(t,e)}},e.prototype.sendTracer=function(e,t){try{var i=this.collect.eventManager.merge(e);t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify(i)):this.fetch(this.reportUrl,i),this.tracerCache=null}catch(e){}},e.prototype.processTracer=function(e,t,i){var n={count:e,state:i,key:t,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:I};"f_net"!==i&&"f_data"!==i||(n.errorCode=this.errorCode[i]);var o=this.collect.processEvent("applog_trace",n);if(o&&o.event)return delete o.is_bav,o},e.prototype.listener=function(){var e=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.leavePage()}),f(function(){e.leavePage()})},e.prototype.leavePage=function(){this.report(!0)},e}();try{var bt=ce();bt&&(bt.LogTracer=function(e,t){(new yt).apply(e,t)})}catch(e){console.log(e)}var Et=function(){function e(){this.verifyReady=!1,this.cleanStatus=!1}return e.prototype.apply=function(e,t){var i=this;b()||(this.collector=e,this.config=t,this.eventStorage=[],this.collector.on("submit-verify-h5",function(e){e&&e.length&&i.eventStore(e[0])}),this.checkUrl(),this.heartbeat())},e.prototype.checkUrl=function(){var e=window.location.href,t=_(e);t._r_d_&&t._r_c_k_?(this.verifyReady=!0,this.domain=t._r_d_,this.key=t._r_c_k_,this.checkCache()):this.collector.off("submit-verify-h5")},e.prototype.checkCache=function(){this.eventStorage.length&&this.postVerify(this.eventStorage)},e.prototype.heartbeat=function(){var e=this;this.heart=setInterval(function(){var t={event:"simulator_test__",local_time_ms:Date.now()},i=e.collector.configManager.get(),n=i.header,o={events:[t],user:i.user,header:n};e.eventStore(o)},6e4)},e.prototype.eventStore=function(e){this.cleanStatus||(this.verifyReady?this.postVerify(e):this.eventStorage.push(e))},e.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[],clearInterval(this.heart)},e.prototype.postVerify=function(e){var t=this;try{var i=JSON.parse(JSON.stringify(e));a(e)?i.forEach(function(e){t.fetchLog(e)}):this.fetchLog(i)}catch(e){console.log("web verify post error ~")}},e.prototype.fetchLog=function(e){X("".concat(this.domain,"/simulator/h5/log?connection_key=").concat(this.key),e,2e4,!1)},e.prototype.leave=function(){var e=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.cleanVerify()}),f(function(){e.cleanVerify()})},e}(),wt=function(){function e(){this.retryWaitTime=3e3,this.retryStatus=!1,this.retryCacheStatus=!1}return e.prototype.apply=function(e,t){var i=this;if(t.enable_storage&&!t.disable_storage&&(this.collect=e,this.config=t,!this.collect.destroyInstance)){var n=e.Types,o=e.adapters,r=o.storage,a=o.fetch;this.storage=new r(!1),this.fetch=a,this.eventUrl=this.collect.configManager.getUrl("event"),this.eventKey="__tea_cache_events_".concat(t.app_id),this.storageNum=t.storage_num||50,this.retryNum=t.retry_num||3,this.retryInterval=1e3,e.on(n.SubmitError,function(e){"f_data"===e.type&&i.storeData(e)}),e.on(n.Ready,function(){i.checkStorage()})}},e.prototype.retryRightNow=function(e){var t=this;if(this.retryStatus)this.errorCache.push(e);else{var i=0;this.retryStatus=!0;var n=setInterval(function(){if(3===i)return t.storeData(t.errorCache),t.retryStatus=!1,void clearInterval(n);var o=e.eventData;t.fetchData(o,function(){t.retryStatus=!1,clearInterval(n),t.retryCacheStatus&&t.errorCache.splice(0,1),t.errorCache.length&&(t.retryCacheStatus=!0,t.retryRightNow(t.errorCache[0]))},function(){i++})},this.retryInterval)}},e.prototype.storeData=function(e){var t=this.storage.getItem(this.eventKey),i=e.eventData;Object.keys(t).length!==this.storageNum&&(t[Date.now()]=i,this.storage.setItem(this.eventKey,t))},e.prototype.checkStorage=function(){var e=this;try{if(!window.navigator.onLine)return;var t=this.storage.getItem(this.eventKey);if(!t||!Object.keys(t).length)return;var i={events:[{event:"ontest",params:{app_id:this.config.app_id},local_time_ms:Date.now()}],user:{user_unique_id:this.collect.configManager.get("web_id")},header:{}};this.fetchData([i],function(){var i=JSON.parse(JSON.stringify(t)),n=function(n){e.fetchData(t[n],function(){delete i[n],e.storage.setItem(e.eventKey,i)},function(){},!1)};for(var o in t)n(o)},function(){},!0)}catch(e){console.warn("error check storage")}},e.prototype.fetchData=function(e,t,i,n){this.fetch(this.eventUrl,e,3e4,!1,function(){t&&t()},function(){i&&i(),console.log("network error，compensate report failk")},n&&!this.config.channel_domain?"566f58151b0ed37e":"")},e}(),St=function(){function e(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}return e.prototype.apply=function(e,t){if(t.spa||t.autotrack){var i=e.Types;this.collect=e,this.config=t,this.appid=t.app_id,this.allowHash=t.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),e.emit(i.RouteReady)}},e.prototype.setKey=function(){var e=this.collect.adapters.storage;this.storage=new e(!1),this.cache_key="__tea_cache_refer_".concat(this.appid),this.cache={refer_key:"",refer_title:document.title||location.pathname,refer_manual_key:"",routeChange:!1},this.config.autotrack&&"object"==typeof this.config.autotrack&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},e.prototype.hack=function(){var e=this,n=window.history.pushState;history.pushState=function(o){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];"function"==typeof history.onpushstate&&history.onpushstate({state:o});var s=n.call.apply(n,i([history,o],t(r)));if(e.collect.emit("STATE_CHANGE",o),e.lastLocation===location.href)return s;e.setReferCache(e.lastLocation);var c=e.getPopStateChangeEventData();return e.lastLocation=location.href,e.sendPv(c,"pushState"),s};var o=history.replaceState;history.replaceState=function(n){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];"function"==typeof history.onreplacestate&&history.onreplacestate({state:n});var s=o.call.apply(o,i([history,n],t(r)));if(e.collect.emit("STATE_CHANGE",n),e.lastLocation===location.href)return s;e.setReferCache(e.lastLocation);var c=e.getPopStateChangeEventData();return e.lastLocation=location.href,e.sendPv(c),s}},e.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},e.prototype.getLocation=function(){return this.lastLocation},e.prototype.init=function(){var e=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:e,init:!0})},e.prototype.listener=function(){var e=this,t=null;window.addEventListener("hashchange",function(i){if(e.lastLocation!==window.location.href&&(clearTimeout(t),e.allowHash)){e.setReferCache(e.lastLocation),e.lastLocation=window.location.href;var n=e.getPopStateChangeEventData();e.sendPv(n)}}),window.addEventListener("popstate",function(i){e.lastLocation!==window.location.href&&(t=setTimeout(function(){e.setReferCache(e.lastLocation),e.lastLocation=window.location.href;var t=e.getPopStateChangeEventData();e.sendPv(t)},10))})},e.prototype.getPopStateChangeEventData=function(){var e=this.pageConfig();return e.is_back=0,e},e.prototype.pageConfig=function(){try{var e=this.storage.getItem(this.cache_key)||{},t=!1,i=this.storage.getItem("__tea_cache_first_".concat(this.appid));return t=!i||1!=i,{is_html:1,url:location.href,referrer:this.handleRefer(),page_key:location.href,refer_page_key:this.handleRefer(),page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:e&&e.refer_manual_key||"",refer_page_title:e&&e.refer_title||"",page_path:this.collect.handlePath(),url_path:this.collect.handlePath(),page_host:location.host,is_first_time:"".concat(t)}}catch(e){return this.collect.emit(G.DEBUGGER_MESSAGE,{type:G.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),{}}},e.prototype.sendPv=function(e,t){this.collect.emit("route-change",{config:e,init:!1})},e.prototype.handleRefer=function(){var e="";try{var t=this.storage.getItem(this.cache_key)||{};e=t.routeChange?t.refer_key:this.collect.configManager.get("referrer")}catch(t){e=document.referrer}return e},e.prototype.setReferCache=function(e){var t=this.storage.getItem(this.cache_key)||{};t.refer_key=e,t.routeChange=!0,this.storage.setItem(this.cache_key,t)},e}();try{var kt=ce();kt&&(kt.LogRoute=function(e,t){(new St).apply(e,t)})}catch(e){console.log(e)}var Tt=["getConfig","getAbSdkVersion"],At=["init","usePlugin","autoInitializationRangers","on"],Ot=function(){function e(e){this.task=[],this.newProcessTask=[],this.processMap=!1,this.Collector=e,this.collectMap=new Map,this.processMap=new Map}return e.prototype.processTask=function(){var e=this;if(this.task.length){var n=this.findIndex(this.task,At,"0");if(-1!==n){var o=this.processScope(this.task[n][0]).scope;this.processMap.set(o,!0),this.processCmd.apply(this,i([],t(this.task[n]))),this.newProcessTask=this.task.filter(function(e){if("default"===o){if(-1===e[0].indexOf("."))return e}else if(-1!==e[0].indexOf("".concat(o,".")))return e});var r=this.findIndex(this.newProcessTask,At,"0");this.newProcessTask.forEach(function(n,o){o!==r&&e.processCmd.apply(e,i([],t(n)))}),this.newProcessTask=[]}}},e.prototype.processCmd=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(a(e)){var i=this.processScope(e[0]),n=i.scope,o=i.cmd;if(!this.processMap.get(n))return this.task.push(e),void this.processTask();if(e.splice(0,1),-1!==Tt.indexOf(o))return this.callCmd(n,o,e);this.callCmd(n,o,e)}},e.prototype.callCmd=function(e,n,o){try{if(-1!==At.indexOf(n)&&(this.collectMap.get(e)||(this.collect=new this.Collector(e),this.collectMap.set(e,this.collect))),!this.collectMap.get(e))return void console.log("init or use must be first call, cmd:".concat(n));var r=this.collectMap.get(e);if(r&&r[n])if("event"===n)r.event.apply(r,i([n],t(o)));else{if(-1!==Tt.indexOf(n))return r[n].apply(r,i([],t(o)));r[n].apply(r,i([],t(o)))}else r.event.apply(r,i([n],t(o)))}catch(e){console.log(e.message)}},e.prototype.findIndex=function(e,t,i){var n=this,o=-1;try{e.forEach(function(e,r){var a=void 0!==i?e[i]:e,s=n.processScope(a).cmd;-1!==t.indexOf(s)&&(o=r)})}catch(e){return o}return o},e.prototype.processScope=function(e){var t="default";try{if("string"==typeof e&&e.indexOf(".")>-1){var i=e.split(".");t=i[0],e=i[1]}}catch(i){return{scope:t,cmd:e}}return{scope:t,cmd:e}},e}();de.usePlugin(Oe,"ab"),de.usePlugin(Ce,"stay"),de.usePlugin(mt,"autotrack"),de.usePlugin(wt,"store"),de.usePlugin(Et,"verify_h5"),de.usePlugin(Re,"heartbeat"),de.usePlugin(Ge,"monitor"),de.usePlugin(St,"route"),de.usePlugin(yt,"tracer"),function(e){if("undefined"!=typeof window){var t=function(){if("undefined"!=typeof window)return window.LogAnalyticsObject||window.TeaAnalyticsObject}();if(t&&window[t]){var i=window[t];i.sdkLoad?console.log("you page has load sdk file already, do not load another sdk file"):(e.task=i.q||[],window[t]=e.processCmd.bind(e),window[t].sdkLoad=!0,e.processTask())}}}(new Ot(de))}();
